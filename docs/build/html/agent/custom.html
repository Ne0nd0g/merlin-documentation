<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Custom Build &mdash; Merlin BETA documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=850acc4c"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="FAQ" href="../cli/faq.html" />
    <link rel="prev" title="DLL Agent" href="dll.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Merlin
          </a>
              <div class="version">
                0.8.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">FAQ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../faq/faq.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quick Start</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickStart/quickstart.html">Quick Start</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Merlin Agent</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command Line Flags</a></li>
<li class="toctree-l1"><a class="reference internal" href="dll.html">DLL Agent</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Custom Build</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#basic">Basic</a></li>
<li class="toctree-l2"><a class="reference internal" href="#advanced">Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="#windows-agent">Windows Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cross-compiling">Cross-Compiling</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Merlin CLI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cli/faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/cli.html">Command Line Flags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/tls.html">TLS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/listeners.html">Listeners</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/commands.html">Command Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/menu/main.html">Main Menu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/menu/agents.html">Agent Menu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/menu/listeners.html">Listener Menu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/menu/modules.html">Modules Menu</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Merlin Server</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../server/server.html">Command Line Flags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server/logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server/x509.html">TLS Certificates</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/build.html">Building Modules</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Misc.</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/blogs.html">Blog Posts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/contrib.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/logging.html">Logging</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Merlin</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Custom Build</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/agent/custom.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="custom-build">
<h1>Custom Build<a class="headerlink" href="#custom-build" title="Link to this heading"></a></h1>
<p>This section details how to build custom build a Merlin Agent using the Make file.</p>
<p><strong>NOTE:</strong> Merlin is distributed with pre-compiled agent binaries for all major platforms in the <code class="docutils literal notranslate"><span class="pre">data/bin</span></code> directory.</p>
<section id="basic">
<h2>Basic<a class="headerlink" href="#basic" title="Link to this heading"></a></h2>
<p>The provided Make file can be used to build a new agent from <strong>source</strong>. It is recommended that you first use
<code class="docutils literal notranslate"><span class="pre">go</span> <span class="pre">get</span> <span class="pre">github.com/Ne0nd0g/merlin-agent</span></code> to pull a copy of the Merlin source code to the host. Move into the Merlin root
directory where the Make file is located.</p>
<ul class="simple">
<li><p>Windows agent: <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">windows</span></code></p></li>
<li><p>Linux agent: <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">linux</span></code></p></li>
<li><p>macOS agent: <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">darwin</span></code></p></li>
<li><p>MIPS agent: <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">mips</span></code></p></li>
<li><p>ARM agent: <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">arm</span></code></p></li>
</ul>
</section>
<section id="advanced">
<h2>Advanced<a class="headerlink" href="#advanced" title="Link to this heading"></a></h2>
<p>Use the provided Make file to build a Merlin Agent with hard coded values. This removes the need for an operator to use
commandline arguments and allows the Agent to simply be executed. The table below shows configurable compile options</p>
<p>View the <a class="reference internal" href="../cli/listeners.html"><span class="doc">Listeners</span></a> page for additional information on specific listener configurable options.</p>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">Build Options</span><a class="headerlink" href="#id1" title="Link to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ADDR</p></td>
<td><p>The interface and port for peer-to-peer agents to bind or connect to</p></td>
<td><p>Overrides the <code class="docutils literal notranslate"><span class="pre">-addr</span></code> flag</p></td>
</tr>
<tr class="row-odd"><td><p>AUTH</p></td>
<td><p>The method of Agent authentication to the server</p></td>
<td><p>Overrides the <code class="docutils literal notranslate"><span class="pre">-auth</span></code> flag</p></td>
</tr>
<tr class="row-even"><td><p>HEADERS</p></td>
<td><p>Comma Separated list of HTTP headers to send with every HTTP request.</p></td>
<td><p>Overrides the <code class="docutils literal notranslate"><span class="pre">-headers</span></code> flag</p></td>
</tr>
<tr class="row-odd"><td><p>HOST</p></td>
<td><p>HTTP Host header</p></td>
<td><p>Overrides the <code class="docutils literal notranslate"><span class="pre">-host</span></code> commandline flag</p></td>
</tr>
<tr class="row-even"><td><p>JA3</p></td>
<td><p>JA3 signature string (not the MD5 hash)</p></td>
<td><p>Overrides the <code class="docutils literal notranslate"><span class="pre">-ja3</span></code> commandline flag</p></td>
</tr>
<tr class="row-odd"><td><p>KILLDATE</p></td>
<td><p>The date, as a Unix EPOCH timestamp, that the agent will quit running</p></td>
<td><p>Overrides the <code class="docutils literal notranslate"><span class="pre">-killdate</span></code> commandline flag</p></td>
</tr>
<tr class="row-even"><td><p>LISTENER</p></td>
<td><p>The UUID of the listener that the peer-to-peer agent is configured to communicate with.</p></td>
<td><p>Overrides the <code class="docutils literal notranslate"><span class="pre">-listener</span></code> flag</p></td>
</tr>
<tr class="row-odd"><td><p>RETRY</p></td>
<td><p>The maximum amount of failed checkins before the agent will quit running</p></td>
<td><p>Overrides the <code class="docutils literal notranslate"><span class="pre">-maxretry</span></code> commandline flag</p></td>
</tr>
<tr class="row-even"><td><p>PAD</p></td>
<td><p>The maximum amount of data that will be randomly selected and appended to every message</p></td>
<td><p>Overrides the <code class="docutils literal notranslate"><span class="pre">-padding</span></code> commandline flag</p></td>
</tr>
<tr class="row-odd"><td><p>PROTO</p></td>
<td><p>Protocol for the agent to connect with [https (HTTP/1.1), http (HTTP/1.1 Clear-Text), h2 (HTTP/2), h2c (HTTP/2 Clear-Text), http3 (QUIC or HTTP/3.0)] (default ‘h2’)</p></td>
<td><p>Overrides the <code class="docutils literal notranslate"><span class="pre">-proto</span></code> commandline flag</p></td>
</tr>
<tr class="row-even"><td><p>PROXY</p></td>
<td><p>Hardcoded proxy to use for http/1.1 traffic only that will override host configuration</p></td>
<td><p>Overrides the <code class="docutils literal notranslate"><span class="pre">-proxy</span></code> commandline flag</p></td>
</tr>
<tr class="row-odd"><td><p>PSK</p></td>
<td><p>Pre-Shared Key used to encrypt initial communications (default “merlin”)</p></td>
<td><p>Overrides the <code class="docutils literal notranslate"><span class="pre">-psk</span></code> commandline flag</p></td>
</tr>
<tr class="row-even"><td><p>SKEW</p></td>
<td><p>Amount of skew, or variance, between agent checkins</p></td>
<td><p>Overrides the <code class="docutils literal notranslate"><span class="pre">-skew</span></code> commandline flag</p></td>
</tr>
<tr class="row-odd"><td><p>SLEEP</p></td>
<td><p>The amount of time the Agent will sleep between checkins Must use golang time notation (e.g., <code class="docutils literal notranslate"><span class="pre">10s</span></code> for ten seconds)</p></td>
<td><p>Overrides the <code class="docutils literal notranslate"><span class="pre">-sleep</span></code> command line flag</p></td>
</tr>
<tr class="row-even"><td><p>TRANSFORMS</p></td>
<td><p>Ordered CSV of transforms to construct a message with</p></td>
<td><p>Overrides the <code class="docutils literal notranslate"><span class="pre">-transforms</span></code> commandline flag.</p></td>
</tr>
<tr class="row-odd"><td><p>URL</p></td>
<td><p>Full URL for agent to connect to (default “<a class="reference external" href="https://127.0.0.1:443">https://127.0.0.1:443</a>”)</p></td>
<td><p>Overrides the <code class="docutils literal notranslate"><span class="pre">-url</span></code> commandline flag</p></td>
</tr>
<tr class="row-even"><td><p>USERAGENT</p></td>
<td><p>The HTTP User-Agent header string that Agent will use while sending traffic</p></td>
<td><p>Overrides the <code class="docutils literal notranslate"><span class="pre">-useragent</span></code> commandline flag</p></td>
</tr>
</tbody>
</table>
<p>An example of creating a new Linux HTTP agent that is using domain fronting through <code class="docutils literal notranslate"><span class="pre">https://merlin.com/c2endpoint.php</span></code> using a PSK of <code class="docutils literal notranslate"><span class="pre">SecurePassword1</span></code>:</p>
<p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">linux</span> <span class="pre">URL=https://merlin.com:443/c2endpoint.php</span> <span class="pre">HOST=myendpoint.azureedge.net</span> <span class="pre">PROTO=https</span> <span class="pre">PSK=SecurePassword1</span></code></p>
</section>
<section id="windows-agent">
<h2>Windows Agent<a class="headerlink" href="#windows-agent" title="Link to this heading"></a></h2>
<p>The Windows Merlin Agent executable is compiled as a GUI application instead of console application. The Merlin Agent
does not have a GUI component. The reason this is used is so that the Merlin Agent window disappears after it is executed.
This behavior is intentional so that the user will not see the application window. This is done with the LDFLAGS when
building the agent using the <code class="docutils literal notranslate"><span class="pre">-H=windowsgui</span></code> option as shown <a class="reference external" href="https://golang.org/cmd/link/">here</a></p>
<p>This causes problems when a user <strong>WANTS</strong> to see the Merlin Agent verbose or debug output. To view Merlin verbose/debug
output, use the Makefile <code class="docutils literal notranslate"><span class="pre">windows-debug</span></code> target (e.g., <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">windows-debug</span></code>)</p>
</section>
<section id="cross-compiling">
<h2>Cross-Compiling<a class="headerlink" href="#cross-compiling" title="Link to this heading"></a></h2>
<p>The Merlin agent and server can be cross-compiled to any operating system or architecture.
A list of golang supported operating systems and architectures can be found here: <a class="reference external" href="https://golang.org/doc/install/source#environment">https://golang.org/doc/install/source#environment</a></p>
<table class="docutils align-default" id="id2">
<caption><span class="caption-text">Supported Platforms</span><a class="headerlink" href="#id2" title="Link to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>$GOOS</p></th>
<th class="head"><p>$GOARCH</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>android</p></td>
<td><p>arm</p></td>
</tr>
<tr class="row-odd"><td><p>darwin</p></td>
<td><p>386</p></td>
</tr>
<tr class="row-even"><td><p>darwin</p></td>
<td><p>amd64</p></td>
</tr>
<tr class="row-odd"><td><p>darwin</p></td>
<td><p>arm</p></td>
</tr>
<tr class="row-even"><td><p>darwin</p></td>
<td><p>arm64</p></td>
</tr>
<tr class="row-odd"><td><p>dragonfly</p></td>
<td><p>amd64</p></td>
</tr>
<tr class="row-even"><td><p>freebsd</p></td>
<td><p>386</p></td>
</tr>
<tr class="row-odd"><td><p>freebsd</p></td>
<td><p>amd64</p></td>
</tr>
<tr class="row-even"><td><p>freebsd</p></td>
<td><p>arm</p></td>
</tr>
<tr class="row-odd"><td><p>linux</p></td>
<td><p>386</p></td>
</tr>
<tr class="row-even"><td><p>linux</p></td>
<td><p>amd64</p></td>
</tr>
<tr class="row-odd"><td><p>linux</p></td>
<td><p>arm</p></td>
</tr>
<tr class="row-even"><td><p>linux</p></td>
<td><p>arm64</p></td>
</tr>
<tr class="row-odd"><td><p>linux</p></td>
<td><p>ppc64</p></td>
</tr>
<tr class="row-even"><td><p>linux</p></td>
<td><p>ppc64le</p></td>
</tr>
<tr class="row-odd"><td><p>linux</p></td>
<td><p>mips</p></td>
</tr>
<tr class="row-even"><td><p>linux</p></td>
<td><p>mipsle</p></td>
</tr>
<tr class="row-odd"><td><p>linux</p></td>
<td><p>mips64</p></td>
</tr>
<tr class="row-even"><td><p>linux</p></td>
<td><p>mips64le</p></td>
</tr>
<tr class="row-odd"><td><p>netbsd</p></td>
<td><p>386</p></td>
</tr>
<tr class="row-even"><td><p>netbsd</p></td>
<td><p>amd64</p></td>
</tr>
<tr class="row-odd"><td><p>netbsd</p></td>
<td><p>arm</p></td>
</tr>
<tr class="row-even"><td><p>openbsd</p></td>
<td><p>386</p></td>
</tr>
<tr class="row-odd"><td><p>openbsd</p></td>
<td><p>amd64</p></td>
</tr>
<tr class="row-even"><td><p>openbsd</p></td>
<td><p>arm</p></td>
</tr>
<tr class="row-odd"><td><p>plan9</p></td>
<td><p>386</p></td>
</tr>
<tr class="row-even"><td><p>plan9</p></td>
<td><p>amd64</p></td>
</tr>
<tr class="row-odd"><td><p>solaris</p></td>
<td><p>amd64</p></td>
</tr>
<tr class="row-even"><td><p>windows</p></td>
<td><p>386</p></td>
</tr>
<tr class="row-odd"><td><p>windows</p></td>
<td><p>amd64</p></td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="dll.html" class="btn btn-neutral float-left" title="DLL Agent" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../cli/faq.html" class="btn btn-neutral float-right" title="FAQ" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Russel Van Tuyl (@Ne0nd0g).</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>